<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FLOW TERMINAL</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:#000}
::-webkit-scrollbar-thumb{background:#333}
body{font-family:'JetBrains Mono',monospace;background:#000;color:#c8c8c8;font-size:12px;line-height:1.4;overflow-x:hidden}

/* Bloomberg Colors */
:root{
  --bg:#000000;--panel:#0a0a0a;--border:#1a1a1a;
  --orange:#fb8b1e;--blue:#0068ff;--green:#4af6c3;--red:#ff433d;
  --yellow:#f5d90a;--white:#e8e8e8;--dim:#666;--mid:#999;
}

/* Header */
.hdr{background:#111;border-bottom:2px solid var(--orange);padding:4px 12px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}
.hdr-left{display:flex;align-items:center;gap:12px}
.hdr-title{color:var(--orange);font-weight:700;font-size:14px;letter-spacing:1px}
.hdr-status{padding:1px 6px;font-size:10px;font-weight:700;letter-spacing:1px}
.status-live{color:#000;background:var(--green)}
.status-server{color:#000;background:var(--yellow)}
.status-disconnected{color:#fff;background:var(--red)}
.status-demo{color:#000;background:var(--dim)}
.hdr-rt{padding:1px 5px;font-size:9px;font-weight:700;letter-spacing:0.5px;margin-left:4px}
.rt-realtime{color:var(--green);border:1px solid var(--green)}
.rt-delayed{color:var(--orange);border:1px solid var(--orange)}
.hdr-clock{color:var(--green);font-size:13px;font-weight:600}
.hdr-tag{color:var(--dim);font-size:10px}

/* Layout */
.wrap{padding:6px 8px;display:flex;flex-direction:column;gap:4px}
.row{display:flex;gap:4px}
.row>.col{flex:1;min-width:0}

/* Panel */
.pnl{background:var(--panel);border:1px solid var(--border);overflow:hidden}
.pnl-hdr{background:#111;border-bottom:1px solid var(--border);padding:3px 8px;display:flex;justify-content:space-between;align-items:center}
.pnl-title{color:var(--orange);font-weight:700;font-size:11px;letter-spacing:0.5px;text-transform:uppercase}
.pnl-ts{color:var(--dim);font-size:9px;margin-left:auto;padding-left:8px;white-space:nowrap}
.pnl-sub{color:var(--dim);font-size:10px}
.pnl-body{padding:4px 6px}

/* Ticker Strip */
.tickers{display:flex;gap:2px;overflow-x:auto;padding:2px 0}
.tk{padding:4px 10px;background:#0a0a0a;border:1px solid var(--border);flex:1;min-width:0;cursor:default}
.tk-sym{color:var(--yellow);font-weight:700;font-size:11px}
.tk-price{color:var(--white);font-weight:700;font-size:15px;margin:2px 0}
.tk-chg{font-weight:600;font-size:11px}
.tk-hilo{color:var(--dim);font-size:9px;margin-top:1px}
.tk-vol{color:var(--dim);font-size:10px}
.up{color:var(--green)}.dn{color:var(--red)}

/* Tables */
table{width:100%;border-collapse:collapse;font-size:11px}
th{background:#111;color:var(--orange);font-weight:600;padding:3px 6px;text-align:right;border-bottom:1px solid var(--border);white-space:nowrap;position:sticky;top:0;z-index:5;font-size:10px;letter-spacing:0.3px;text-transform:uppercase}
th:first-child{text-align:left}
td{padding:2px 6px;text-align:right;border-bottom:1px solid #0d0d0d;white-space:nowrap}
td:first-child{text-align:left}
tbody tr:hover{background:#0f0f0f}

/* Flow table specifics */
.tbl-wrap{max-height:320px;overflow-y:auto}
.call-row{border-left:2px solid var(--green)}
.put-row{border-left:2px solid var(--red)}
.golden-row{background:#1a1200 !important;border-left:2px solid var(--yellow)}
.golden-row:hover{background:#221800 !important}
.badge{display:inline-block;padding:0 4px;font-weight:700;font-size:10px;letter-spacing:0.5px}
.badge-c{color:#000;background:var(--green)}
.badge-p{color:#000;background:var(--red)}
.badge-bull{color:var(--green)}
.badge-bear{color:var(--red)}
.badge-neut{color:var(--dim)}
.golden-tag{color:var(--yellow);font-size:10px;margin-right:2px}
.exp-tag{color:var(--dim);font-size:9px}

/* Sentiment cards grid */
.sent-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:4px}
.sent-card{background:var(--panel);border:1px solid var(--border);padding:6px 8px}
.sent-sym{color:var(--yellow);font-weight:700;font-size:12px}
.sent-price{color:var(--white);font-weight:700;font-size:14px;margin:2px 0}
.sent-row{display:flex;justify-content:space-between;font-size:10px;color:var(--dim)}
.sent-val{color:var(--mid);font-weight:600}
.sent-bar{height:3px;background:#1a1a1a;margin:4px 0 2px}
.sent-fill{height:100%;min-width:4px}
.pc-tag{font-size:10px;font-weight:700;padding:1px 4px;display:inline-block;margin-top:2px}
.pc-bull{color:var(--green);border:1px solid var(--green)}
.pc-bear{color:var(--red);border:1px solid var(--red)}
.pc-neut{color:var(--yellow);border:1px solid var(--yellow)}

/* Filters */
.filters{display:flex;gap:4px;padding:4px 0;align-items:center}
.fbtn{padding:2px 8px;background:#111;border:1px solid var(--border);color:var(--mid);cursor:pointer;font-family:inherit;font-size:10px;font-weight:600}
.fbtn:hover{border-color:var(--orange);color:var(--orange)}
.fbtn.on{background:var(--orange);color:#000;border-color:var(--orange)}
.fsel{padding:2px 6px;background:#111;border:1px solid var(--border);color:var(--mid);font-family:inherit;font-size:10px}

/* Feed banner */
.feed-banner{display:flex;gap:8px;align-items:center;padding:3px 8px;background:#050500;border:1px solid #1a1a00;font-size:10px;color:var(--dim);margin-bottom:2px}
.feed-dot{width:6px;height:6px;border-radius:50%;background:var(--green)}
.feed-ct{color:var(--green);font-weight:700}

/* Chain - unified table */
.chain-wrap{overflow-y:auto;max-height:calc(100vh - 200px)}
.chain-sel{display:flex;gap:6px;align-items:center}
.strike-col{text-align:center !important;background:#111 !important;font-weight:700;color:var(--mid);border-left:1px solid var(--border);border-right:1px solid var(--border);width:70px}
.strike-col.atm-strike{color:var(--orange) !important}
.atm{background:#0a0f1a !important}

/* Chart containers */
.chart-box{position:relative;height:200px}

/* Footer */
.ftr{padding:4px 12px;border-top:1px solid var(--border);color:var(--dim);font-size:9px;display:flex;justify-content:space-between;margin-top:4px}

/* Connection Overlay */
.conn-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.95);z-index:9999;display:flex;align-items:center;justify-content:center}
.conn-box{background:#0a0a0a;border:2px solid var(--orange);padding:32px 40px;max-width:460px;width:100%;font-family:'JetBrains Mono',monospace}
.conn-title{color:var(--orange);font-weight:700;font-size:18px;letter-spacing:2px;text-align:center;margin-bottom:4px}
.conn-sub{color:var(--dim);font-size:10px;text-align:center;margin-bottom:24px}
.conn-mode{display:flex;gap:0;margin-bottom:20px}
.conn-mode-btn{flex:1;padding:8px;text-align:center;background:#111;border:1px solid var(--border);color:var(--dim);cursor:pointer;font-family:inherit;font-size:11px;font-weight:600;letter-spacing:0.5px}
.conn-mode-btn.active{background:var(--orange);color:#000;border-color:var(--orange)}
.conn-mode-btn:hover:not(.active){border-color:var(--orange);color:var(--orange)}
.conn-section{display:none}
.conn-section.active{display:block}
.conn-label{color:var(--mid);font-size:10px;font-weight:600;letter-spacing:0.5px;margin-bottom:4px;display:block;text-transform:uppercase}
.conn-input{width:100%;padding:8px 10px;background:#111;border:1px solid var(--border);color:var(--white);font-family:inherit;font-size:12px;margin-bottom:12px;outline:none}
.conn-input:focus{border-color:var(--orange)}
.conn-input::placeholder{color:#444}
.conn-btn{width:100%;padding:10px;background:var(--orange);color:#000;font-weight:700;font-family:inherit;font-size:13px;letter-spacing:1px;border:none;cursor:pointer;margin-top:8px}
.conn-btn:hover{opacity:0.9}
.conn-btn:disabled{opacity:0.5;cursor:not-allowed}
.conn-disclaimer{color:#444;font-size:9px;text-align:center;margin-top:16px;line-height:1.6}
.conn-error{color:var(--red);font-size:10px;margin-top:8px;display:none}
.conn-demo{text-align:center;margin-top:12px}
.conn-demo a{color:var(--dim);font-size:10px;text-decoration:underline;cursor:pointer}
.conn-demo a:hover{color:var(--orange)}

/* Responsive */
@media(max-width:1200px){.sent-grid{grid-template-columns:repeat(3,1fr)}.chain-wrap{overflow-x:auto}}
@media(max-width:768px){.sent-grid{grid-template-columns:repeat(2,1fr)}.row{flex-direction:column}}
</style>
</head>
<body>

<!-- Connection Overlay -->
<div class="conn-overlay" id="connOverlay">
  <div class="conn-box">
    <div class="conn-title">FLOW TERMINAL</div>
    <div class="conn-sub">Bloomberg-style options flow dashboard powered by LSEG</div>
    <div class="conn-mode">
      <div class="conn-mode-btn active" data-mode="local">LOCAL MODE</div>
      <div class="conn-mode-btn" data-mode="server">SERVER MODE</div>
    </div>
    <div class="conn-section active" id="connLocal">
      <label class="conn-label">App Key</label>
      <input class="conn-input" id="localAppKey" placeholder="Your LSEG App Key (from Workspace)" autocomplete="off">
      <div style="color:var(--dim);font-size:10px;margin-bottom:8px">
        Requires LSEG Workspace + local_bridge.py running on your machine.
      </div>
      <button class="conn-btn" id="localConnect">CONNECT LOCAL</button>
    </div>
    <div class="conn-section" id="connServer">
      <label class="conn-label">Server URL</label>
      <input class="conn-input" id="serverUrl" placeholder="ws://localhost:8000/ws" value="ws://localhost:8000/ws" autocomplete="off">
      <label class="conn-label">App Key</label>
      <input class="conn-input" id="serverAppKey" placeholder="Your LSEG App Key" autocomplete="off">
      <label class="conn-label">Username</label>
      <input class="conn-input" id="serverUser" placeholder="Platform username / machine ID" autocomplete="off">
      <label class="conn-label">Password</label>
      <input class="conn-input" id="serverPass" type="password" placeholder="Platform password" autocomplete="off">
      <button class="conn-btn" id="serverConnect">CONNECT SERVER</button>
    </div>
    <div class="conn-error" id="connError"></div>
    <div class="conn-disclaimer">
      All credentials stay on your machine. Nothing is stored.<br>
      Local mode: data goes Browser ↔ localhost only.<br>
      Server mode: credentials sent over WebSocket (use WSS in production).
    </div>
    <div class="conn-demo"><a id="demoLink" href="?demo" target="_blank">Launch Demo Mode (simulated data)</a></div>
  </div>
</div>

<div class="hdr">
  <div class="hdr-left">
    <span class="hdr-title">FLOW TERMINAL</span>
    <span class="hdr-status status-demo" id="connStatus">DEMO</span>
    <span class="hdr-rt rt-delayed" id="rtBadge" style="display:none">DELAYED</span>
  </div>
  <span class="hdr-clock" id="clock">--:--:--</span>
  <div style="display:flex;gap:12px;align-items:center">
    <span class="hdr-tag">Orders: <span class="feed-ct" id="orderCt">0</span></span>
    <span class="hdr-tag">Premium: <span class="feed-ct" id="totalPrem">$0</span></span>
    <span class="hdr-tag">LSEG/REFINITIV</span>
  </div>
</div>

<div class="wrap">
  <!-- Ticker Strip -->
  <div class="pnl">
    <div class="tickers" id="tickerStrip"></div>
  </div>

  <!-- Sentiment Cards -->
  <div class="pnl">
    <div class="pnl-hdr"><span class="pnl-title">Market Sentiment</span><span class="pnl-sub" id="sentExpLabel">All Expirations</span></div>
    <div class="pnl-body">
      <div class="sent-grid" id="sentGrid"></div>
    </div>
  </div>

  <!-- Main Row: Flow Table + Charts -->
  <div class="row">
    <div class="col" style="flex:2">
      <div class="pnl">
        <div class="pnl-hdr"><span class="pnl-title">Unusual Options Flow</span><span class="pnl-sub" id="flowCount"></span></div>
        <div class="pnl-body">
          <div class="feed-banner">
            <div class="feed-dot" id="feedDot"></div>
            <span id="feedLabel">Live Feed</span>
            <span id="feedPipe">|</span>
            <span id="feedStream">Streaming <span class="feed-ct" id="feedAge">0s</span> ago</span>
          </div>
          <div id="marketClosedBanner" style="display:none;background:#1a1200;border:1px solid #fb8b1e;color:#fb8b1e;padding:4px 10px;font-size:11px;text-align:center;border-radius:4px;margin-bottom:6px;">MARKET CLOSED — Showing last available data</div>
          <div class="filters">
            <button class="fbtn on" data-f="all">ALL</button>
            <button class="fbtn" data-f="calls">CALLS</button>
            <button class="fbtn" data-f="puts">PUTS</button>
            <select class="fsel" id="tkFilter">
              <option value="">ALL TICKERS</option>
              <option>SPY</option><option>QQQ</option><option>AAPL</option><option>MSFT</option><option>NVDA</option>
              <option>TSLA</option><option>AMZN</option><option>GOOG</option><option>META</option>
            </select>
            <select class="fsel" id="expFilter">
              <option value="">ALL EXPIRATIONS</option>
            </select>
          </div>
          <div class="tbl-wrap">
            <table><thead><tr>
              <th>Ticker</th><th>Exp</th><th>Type</th><th>Strike</th><th>Last</th><th>Vol</th><th>OI</th><th>Premium</th><th>Delta</th><th>Signal</th>
            </tr></thead><tbody id="flowBody"></tbody></table>
          </div>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="pnl" style="margin-bottom:4px">
        <div class="pnl-hdr"><span class="pnl-title">Put/Call Ratio</span><span class="pnl-ts" id="pcTs"></span></div>
        <div class="pnl-body"><div class="chart-box"><canvas id="pcChart"></canvas></div></div>
      </div>
      <div class="pnl">
        <div class="pnl-hdr"><span class="pnl-title">Flow Distribution</span><span class="pnl-ts" id="flowDistTs"></span>
          <select class="fsel" id="flowDistFilter" style="margin-left:6px"><option value="all">All</option><option>SPY</option><option>QQQ</option><option>AAPL</option><option>MSFT</option><option>NVDA</option><option>TSLA</option><option>AMZN</option><option>GOOG</option><option>META</option></select>
        </div>
        <div class="pnl-body">
          <div class="row">
            <div class="col"><div class="chart-box" style="height:160px"><canvas id="volDonut"></canvas></div></div>
            <div class="col"><div class="chart-box" style="height:160px"><canvas id="premDonut"></canvas></div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Second Row: Chain + Strike Volume + Net Flow -->
  <div class="row">
    <div class="col">
      <div class="pnl">
        <div class="pnl-hdr">
          <span class="pnl-title" id="chainTitle">SPY Options Chain</span>
          <div class="chain-sel">
            <select class="fsel" id="chainTk">
              <option>SPY</option><option>QQQ</option><option>AAPL</option><option>MSFT</option><option>NVDA</option>
              <option>TSLA</option><option>AMZN</option><option>GOOG</option><option>META</option>
            </select>
            <select class="fsel" id="chainExp"></select>
          </div>
        </div>
        <div class="chain-wrap">
          <table>
            <thead><tr>
              <th>Delta</th><th>OI</th><th>Vol</th><th>IV</th><th>Last</th><th>Bid</th>
              <th class="strike-col">Strike</th>
              <th>Bid</th><th>Last</th><th>IV</th><th>Vol</th><th>OI</th><th>Delta</th>
            </tr></thead>
            <tbody id="chainBody"></tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="pnl" style="margin-bottom:4px">
        <div class="pnl-hdr">
          <span class="pnl-title">Volume by Strike</span><span class="pnl-ts" id="strikeTs"></span>
          <select class="fsel" id="strikeTk" style="margin-left:auto">
            <option>SPY</option><option>QQQ</option><option>AAPL</option><option>MSFT</option><option>NVDA</option>
            <option>TSLA</option><option>AMZN</option><option>GOOG</option><option>META</option>
          </select>
        </div>
        <div class="pnl-body"><div class="chart-box" style="height:280px"><canvas id="strikeChart"></canvas></div></div>
      </div>
      <div class="pnl">
        <div class="pnl-hdr"><span class="pnl-title">Net Flow Sentiment</span><span class="pnl-ts" id="netFlowTs"></span></div>
        <div class="pnl-body"><div class="chart-box" style="height:240px"><canvas id="netChart"></canvas></div></div>
      </div>
    </div>
  </div>
</div>

<div class="ftr">
  <span>Data: LSEG/Refinitiv | For informational purposes only. Not financial advice.</span>
  <span>Built with LSEG MCP + Claude | <span id="ftrTime"></span></span>
</div>

<script>
// ==================== CONFIG ====================
const DEMO_MODE = new URLSearchParams(window.location.search).has('demo');
const TICKERS = ['SPY','QQQ','AAPL','MSFT','NVDA','TSLA','AMZN','GOOG','META'];

// ==================== DEMO DATA (Feb 10 2026) ====================
const DEMO_QUOTES={
  SPY:{last:693.62,chg:-0.33,hi:696.54,lo:692.85,vol:8032384},
  AAPL:{last:273.95,chg:-0.49,hi:275.37,lo:272.94,vol:1402085},
  NVDA:{last:189.33,chg:-0.45,hi:192.48,lo:188.13,vol:7191513},
  TSLA:{last:424.28,chg:6.96,hi:427.24,lo:417.00,vol:1484805},
  QQQ:{last:613.39,chg:-0.93,hi:617.02,lo:612.42,vol:6104761},
  AMZN:{last:208.42,chg:-0.24,hi:212.61,lo:206.46,vol:3058751},
  GOOG:{last:185.43,chg:1.12,hi:186.50,lo:183.90,vol:2145000},
  META:{last:698.50,chg:3.21,hi:701.20,lo:694.80,vol:1876000},
  MSFT:{last:412.75,chg:-1.05,hi:415.30,lo:411.50,vol:2534000}
};

const DEMO_FLOW={
  SPY:{cv:114416,pv:106354,pc:0.930},AAPL:{cv:31837,pv:8446,pc:0.265},
  NVDA:{cv:57905,pv:39398,pc:0.680},TSLA:{cv:97398,pv:58314,pc:0.599},
  QQQ:{cv:40773,pv:56093,pc:1.376},AMZN:{cv:40614,pv:37941,pc:0.934},
  GOOG:{cv:18500,pv:14200,pc:0.768},META:{cv:22300,pv:19800,pc:0.888},
  MSFT:{cv:25400,pv:21600,pc:0.850}
};

const DEMO_UNUSUAL={
  SPY:[
    {s:695,t:'C',v:33902,l:3.31,d:0.4401,exp:'2026-02-13',oi:142800},{s:690,t:'P',v:20706,l:2.55,d:-0.3690,exp:'2026-02-13',oi:98400},
    {s:700,t:'C',v:20426,l:1.04,d:0.2121,exp:'2026-02-14',oi:115200},{s:695,t:'P',v:18197,l:4.27,d:-0.5671,exp:'2026-02-13',oi:87600},
    {s:696,t:'C',v:16365,l:2.74,d:0.3960,exp:'2026-02-13',oi:72400},{s:694,t:'P',v:12930,l:3.87,d:-0.5216,exp:'2026-02-14',oi:63200},
    {s:685,t:'P',v:11836,l:1.53,d:-0.2334,exp:'2026-02-17',oi:54800},{s:697,t:'C',v:8637,l:2.25,d:0.3504,exp:'2026-02-13',oi:41200},
    {s:693,t:'P',v:7806,l:3.49,d:-0.4794,exp:'2026-02-14',oi:38600},{s:694,t:'C',v:7616,l:3.90,d:0.4821,exp:'2026-02-13',oi:35400},
    {s:688,t:'P',v:6968,l:2.07,d:-0.3072,exp:'2026-02-17',oi:31200},{s:692,t:'P',v:6038,l:3.16,d:-0.4399,exp:'2026-02-13',oi:28800},
    {s:696,t:'P',v:5493,l:4.66,d:-0.6143,exp:'2026-02-14',oi:24600},{s:698,t:'C',v:5271,l:1.77,d:0.3040,exp:'2026-02-13',oi:22400},
    {s:693,t:'C',v:4631,l:4.55,d:0.5212,exp:'2026-02-17',oi:19800},{s:689,t:'P',v:4181,l:2.31,d:-0.3369,exp:'2026-02-14',oi:18200},
    {s:701,t:'C',v:3258,l:0.77,d:0.1704,exp:'2026-02-13',oi:15600},{s:699,t:'C',v:3151,l:1.31,d:0.2571,exp:'2026-02-17',oi:14200},
    {s:704,t:'C',v:2973,l:0.26,d:0.0730,exp:'2026-02-14',oi:12800},{s:687,t:'P',v:2435,l:2.01,d:-0.2809,exp:'2026-02-13',oi:11400}
  ],
  AAPL:[
    {s:275,t:'C',v:16425,l:2.04,d:0.4451,exp:'2026-02-13',oi:82400},{s:280,t:'C',v:9394,l:0.52,d:0.1680,exp:'2026-02-14',oi:54200},
    {s:270,t:'P',v:3798,l:1.14,d:-0.2682,exp:'2026-02-13',oi:21600},{s:270,t:'C',v:3334,l:5.19,d:0.7304,exp:'2026-02-17',oi:18400},
    {s:275,t:'P',v:2773,l:3.00,d:-0.5571,exp:'2026-02-14',oi:15200},{s:265,t:'C',v:2684,l:9.35,d:0.8931,exp:'2026-02-13',oi:14800},
    {s:265,t:'P',v:1693,l:0.39,d:-0.1040,exp:'2026-02-17',oi:9200}
  ],
  NVDA:[
    {s:190,t:'C',v:26604,l:2.62,d:0.4701,exp:'2026-02-13',oi:124600},{s:195,t:'C',v:22394,l:0.84,d:0.2117,exp:'2026-02-14',oi:98400},
    {s:185,t:'P',v:13534,l:1.37,d:-0.2831,exp:'2026-02-13',oi:68200},{s:190,t:'P',v:11939,l:3.15,d:-0.5317,exp:'2026-02-17',oi:54800},
    {s:180,t:'P',v:11851,l:0.59,d:-0.1342,exp:'2026-02-13',oi:48200},{s:180,t:'C',v:4708,l:10.00,d:0.8598,exp:'2026-02-14',oi:22400},
    {s:185,t:'C',v:4199,l:5.83,d:0.7145,exp:'2026-02-13',oi:19800},{s:195,t:'P',v:2074,l:6.43,d:-0.7954,exp:'2026-02-17',oi:11200}
  ],
  TSLA:[
    {s:425,t:'C',v:41368,l:6.90,d:0.4959,exp:'2026-02-13',oi:186400},{s:420,t:'C',v:25475,l:9.71,d:0.6072,exp:'2026-02-14',oi:112800},
    {s:430,t:'C',v:23953,l:4.65,d:0.3830,exp:'2026-02-13',oi:98600},{s:430,t:'P',v:20429,l:9.98,d:-0.6179,exp:'2026-02-17',oi:94200},
    {s:420,t:'P',v:19317,l:4.90,d:-0.3920,exp:'2026-02-13',oi:86400},{s:425,t:'P',v:12784,l:7.14,d:-0.5051,exp:'2026-02-14',oi:62400},
    {s:415,t:'C',v:6602,l:12.95,d:0.7081,exp:'2026-02-13',oi:34800},{s:415,t:'P',v:5784,l:3.48,d:-0.2907,exp:'2026-02-17',oi:28600}
  ],
  QQQ:[
    {s:610,t:'P',v:11156,l:3.67,d:-0.3884,exp:'2026-02-13',oi:52400},{s:615,t:'P',v:10219,l:5.46,d:-0.5445,exp:'2026-02-14',oi:48200},
    {s:615,t:'C',v:9146,l:4.29,d:0.4593,exp:'2026-02-13',oi:44800},{s:620,t:'C',v:7371,l:1.94,d:0.2844,exp:'2026-02-17',oi:36200},
    {s:605,t:'P',v:5829,l:2.45,d:-0.2699,exp:'2026-02-13',oi:28400},{s:616,t:'C',v:4341,l:3.62,d:0.4252,exp:'2026-02-14',oi:22600},
    {s:613,t:'P',v:4066,l:4.66,d:-0.4777,exp:'2026-02-13',oi:19800},{s:618,t:'C',v:3220,l:2.72,d:0.3549,exp:'2026-02-17',oi:16400},
    {s:614,t:'P',v:3216,l:5.03,d:-0.5102,exp:'2026-02-14',oi:15200},{s:616,t:'P',v:2661,l:6.11,d:-0.5794,exp:'2026-02-13',oi:13800},
    {s:609,t:'P',v:2634,l:3.46,d:-0.3620,exp:'2026-02-14',oi:12400},{s:619,t:'C',v:2559,l:2.31,d:0.3192,exp:'2026-02-13',oi:11200},
    {s:607,t:'P',v:2505,l:2.83,d:-0.3128,exp:'2026-02-17',oi:10800},{s:614,t:'C',v:2295,l:4.84,d:0.4921,exp:'2026-02-14',oi:9600},
    {s:622,t:'C',v:2052,l:1.24,d:0.2154,exp:'2026-02-13',oi:8400},{s:612,t:'P',v:1926,l:4.30,d:-0.4463,exp:'2026-02-17',oi:7800},
    {s:620,t:'P',v:1906,l:8.25,d:-0.7241,exp:'2026-02-14',oi:7200},{s:617,t:'C',v:1885,l:3.10,d:0.3907,exp:'2026-02-13',oi:6800},
    {s:611,t:'P',v:1784,l:4.17,d:-0.4166,exp:'2026-02-14',oi:6400},{s:610,t:'C',v:1782,l:7.23,d:0.6099,exp:'2026-02-13',oi:5800}
  ],
  AMZN:[
    {s:200,t:'P',v:20824,l:0.53,d:-0.1314,exp:'2026-02-13',oi:92400},{s:215,t:'C',v:20574,l:0.74,d:0.1881,exp:'2026-02-14',oi:88200},
    {s:210,t:'C',v:16648,l:2.16,d:0.4238,exp:'2026-02-13',oi:74600},{s:210,t:'P',v:7171,l:3.60,d:-0.5792,exp:'2026-02-17',oi:34800},
    {s:205,t:'P',v:7044,l:1.48,d:-0.3079,exp:'2026-02-13',oi:32400},{s:215,t:'P',v:2902,l:7.27,d:-0.8207,exp:'2026-02-14',oi:14200},
    {s:205,t:'C',v:2803,l:5.01,d:0.6887,exp:'2026-02-17',oi:12800}
  ],
  GOOG:[
    {s:185,t:'C',v:8200,l:2.80,d:0.4800,exp:'2026-02-13',oi:38400},{s:190,t:'C',v:5400,l:0.95,d:0.2100,exp:'2026-02-14',oi:24600},
    {s:180,t:'P',v:4100,l:1.20,d:-0.2500,exp:'2026-02-13',oi:18800},{s:185,t:'P',v:3800,l:3.10,d:-0.5200,exp:'2026-02-17',oi:16400}
  ],
  META:[
    {s:700,t:'C',v:12400,l:5.50,d:0.4600,exp:'2026-02-13',oi:58200},{s:710,t:'C',v:7800,l:2.10,d:0.2300,exp:'2026-02-14',oi:34800},
    {s:695,t:'P',v:6200,l:3.80,d:-0.3900,exp:'2026-02-13',oi:28600},{s:690,t:'P',v:4500,l:2.40,d:-0.2800,exp:'2026-02-17',oi:21200}
  ],
  MSFT:[
    {s:415,t:'C',v:9800,l:3.20,d:0.4500,exp:'2026-02-13',oi:44800},{s:420,t:'C',v:6100,l:1.40,d:0.2400,exp:'2026-02-14',oi:28200},
    {s:410,t:'P',v:5600,l:2.90,d:-0.3600,exp:'2026-02-13',oi:24600},{s:405,t:'P',v:3200,l:1.50,d:-0.2200,exp:'2026-02-17',oi:15400}
  ]
};

const DEMO_CHAINS={
"SPY":{c:[{s:679,b:16.14,a:16.17,l:16.15,v:48516,d:0.87,iv:0.1413,oi:155054},{s:680,b:15.24,a:15.3,l:15.28,v:62966,d:0.85,iv:0.143,oi:457049},{s:681,b:14.18,a:14.23,l:14.2,v:32437,d:0.85,iv:0.1446,oi:404754},{s:682,b:13.55,a:13.62,l:13.57,v:32127,d:0.82,iv:0.1463,oi:242042},{s:683,b:12.54,a:12.59,l:12.56,v:54948,d:0.81,iv:0.141,oi:210908},{s:684,b:12.11,a:12.15,l:12.13,v:66355,d:0.77,iv:0.1427,oi:230977},{s:685,b:10.79,a:10.84,l:10.83,v:103454,d:0.78,iv:0.1444,oi:572963},{s:686,b:10.86,a:10.9,l:10.87,v:52234,d:0.71,iv:0.1392,oi:254901},{s:687,b:9.92,a:9.96,l:9.95,v:52399,d:0.7,iv:0.1409,oi:174447},{s:688,b:9.63,a:9.7,l:9.67,v:79885,d:0.66,iv:0.1426,oi:309560},{s:689,b:8.92,a:8.99,l:8.96,v:58329,d:0.64,iv:0.1443,oi:498794},{s:690,b:8.14,a:8.22,l:8.18,v:98828,d:0.62,iv:0.139,oi:1359888},{s:691,b:7.31,a:7.36,l:7.34,v:62176,d:0.59,iv:0.1408,oi:272217},{s:692,b:6.09,a:6.17,l:6.15,v:84669,d:0.57,iv:0.1425,oi:554437},{s:693,b:6.39,a:6.46,l:6.41,v:73121,d:0.54,iv:0.1373,oi:463094},{s:694,b:5.79,a:5.86,l:5.81,v:56042,d:0.51,iv:0.139,oi:545294},{s:695,b:5.51,a:5.55,l:5.54,v:140206,d:0.48,iv:0.1408,oi:1559753},{s:696,b:5.14,a:5.21,l:5.17,v:88535,d:0.46,iv:0.1425,oi:262115},{s:697,b:4.44,a:4.47,l:4.45,v:92309,d:0.43,iv:0.1373,oi:215688},{s:698,b:3.94,a:3.98,l:3.95,v:71198,d:0.4,iv:0.139,oi:394295},{s:699,b:2.86,a:2.94,l:2.89,v:53248,d:0.35,iv:0.1408,oi:181350},{s:700,b:2.37,a:2.42,l:2.39,v:105461,d:0.32,iv:0.1356,oi:1353437},{s:701,b:2.36,a:2.43,l:2.42,v:39861,d:0.3,iv:0.1373,oi:376741},{s:702,b:2.53,a:2.58,l:2.55,v:37517,d:0.29,iv:0.1391,oi:168033},{s:703,b:1.66,a:1.73,l:1.7,v:72305,d:0.24,iv:0.1409,oi:175045},{s:704,b:1.77,a:1.8,l:1.78,v:32268,d:0.23,iv:0.1357,oi:372922},{s:705,b:1.5,a:1.58,l:1.52,v:121394,d:0.21,iv:0.1375,oi:793333},{s:706,b:1.06,a:1.14,l:1.09,v:35576,d:0.17,iv:0.1393,oi:221248},{s:707,b:1.03,a:1.07,l:1.06,v:51291,d:0.16,iv:0.1341,oi:184294},{s:708,b:0.68,a:0.73,l:0.7,v:59590,d:0.12,iv:0.1359,oi:202256},{s:709,b:0.95,a:1.0,l:0.98,v:31163,d:0.14,iv:0.1377,oi:407508}],p:[{s:679,b:0.94,a:0.96,l:0.95,v:28461,d:-0.13,iv:0.1413,oi:209536},{s:680,b:1.02,a:1.1,l:1.06,v:60707,d:-0.15,iv:0.143,oi:412661},{s:681,b:0.99,a:1.01,l:1.0,v:30731,d:-0.15,iv:0.1446,oi:421818},{s:682,b:1.35,a:1.4,l:1.37,v:62586,d:-0.18,iv:0.1463,oi:415066},{s:683,b:1.31,a:1.4,l:1.37,v:51916,d:-0.19,iv:0.141,oi:244781},{s:684,b:1.88,a:1.97,l:1.9,v:48597,d:-0.23,iv:0.1427,oi:447140},{s:685,b:1.57,a:1.64,l:1.59,v:95976,d:-0.22,iv:0.1444,oi:492282},{s:686,b:2.63,a:2.71,l:2.67,v:80375,d:-0.29,iv:0.1392,oi:461616},{s:687,b:2.69,a:2.77,l:2.74,v:56946,d:-0.3,iv:0.1409,oi:476933},{s:688,b:3.44,a:3.47,l:3.46,v:68206,d:-0.34,iv:0.1426,oi:368172},{s:689,b:3.71,a:3.77,l:3.72,v:51855,d:-0.36,iv:0.1443,oi:211987},{s:690,b:3.95,a:3.98,l:3.97,v:124304,d:-0.38,iv:0.139,oi:660869},{s:691,b:4.1,a:4.14,l:4.11,v:74510,d:-0.41,iv:0.1408,oi:456523},{s:692,b:3.89,a:3.93,l:3.91,v:76927,d:-0.43,iv:0.1425,oi:415664},{s:693,b:5.19,a:5.22,l:5.21,v:100552,d:-0.46,iv:0.1373,oi:236179},{s:694,b:5.59,a:5.62,l:5.61,v:64753,d:-0.49,iv:0.139,oi:374164},{s:695,b:6.28,a:6.34,l:6.29,v:117943,d:-0.52,iv:0.1408,oi:1371846},{s:696,b:6.93,a:6.99,l:6.97,v:84785,d:-0.54,iv:0.1425,oi:558011},{s:697,b:7.22,a:7.25,l:7.23,v:50177,d:-0.57,iv:0.1373,oi:211379},{s:698,b:7.7,a:7.77,l:7.72,v:44057,d:-0.6,iv:0.139,oi:297036},{s:699,b:7.66,a:7.71,l:7.69,v:85148,d:-0.65,iv:0.1408,oi:533549},{s:700,b:8.13,a:8.21,l:8.19,v:107971,d:-0.68,iv:0.1356,oi:1029129},{s:701,b:9.15,a:9.19,l:9.16,v:42113,d:-0.7,iv:0.1373,oi:287417},{s:702,b:10.29,a:10.36,l:10.34,v:70347,d:-0.71,iv:0.1391,oi:210504},{s:703,b:10.44,a:10.5,l:10.45,v:70551,d:-0.76,iv:0.1409,oi:353505},{s:704,b:11.52,a:11.59,l:11.58,v:39220,d:-0.77,iv:0.1357,oi:409092},{s:705,b:12.27,a:12.35,l:12.33,v:87956,d:-0.79,iv:0.1375,oi:1174038},{s:706,b:12.85,a:12.88,l:12.87,v:41199,d:-0.83,iv:0.1393,oi:212130},{s:707,b:13.8,a:13.84,l:13.82,v:38791,d:-0.84,iv:0.1341,oi:203230},{s:708,b:14.44,a:14.51,l:14.47,v:39006,d:-0.88,iv:0.1359,oi:354285},{s:709,b:15.7,a:15.78,l:15.76,v:26982,d:-0.86,iv:0.1377,oi:233448}]},
"QQQ":{c:[{s:598,b:16.73,a:16.8,l:16.77,v:21816,d:0.88,iv:0.1893,oi:159912},{s:599,b:16.27,a:16.32,l:16.29,v:18678,d:0.84,iv:0.1838,oi:135745},{s:600,b:15.31,a:15.38,l:15.36,v:40410,d:0.83,iv:0.1854,oi:279197},{s:601,b:14.63,a:14.7,l:14.66,v:25633,d:0.8,iv:0.1869,oi:95660},{s:602,b:14.1,a:14.17,l:14.15,v:26506,d:0.77,iv:0.1815,oi:214574},{s:603,b:12.94,a:12.99,l:12.97,v:22958,d:0.77,iv:0.183,oi:206405},{s:604,b:12.49,a:12.55,l:12.51,v:30644,d:0.74,iv:0.1846,oi:123134},{s:605,b:11.25,a:11.29,l:11.27,v:57106,d:0.74,iv:0.1862,oi:278162},{s:606,b:10.23,a:10.3,l:10.27,v:23377,d:0.72,iv:0.1807,oi:173314},{s:607,b:10.6,a:10.65,l:10.62,v:33217,d:0.67,iv:0.1823,oi:242836},{s:608,b:9.56,a:9.63,l:9.58,v:22906,d:0.65,iv:0.1839,oi:167360},{s:609,b:8.52,a:8.6,l:8.56,v:38700,d:0.64,iv:0.1785,oi:130100},{s:610,b:7.62,a:7.66,l:7.63,v:53714,d:0.62,iv:0.1801,oi:360894},{s:611,b:8.0,a:8.04,l:8.02,v:37745,d:0.58,iv:0.1817,oi:131737},{s:612,b:6.72,a:6.78,l:6.74,v:46227,d:0.56,iv:0.1834,oi:199646},{s:613,b:6.75,a:6.78,l:6.76,v:34917,d:0.53,iv:0.178,oi:133943},{s:614,b:6.18,a:6.26,l:6.23,v:41696,d:0.5,iv:0.1796,oi:153479},{s:615,b:5.64,a:5.71,l:5.67,v:56981,d:0.48,iv:0.1813,oi:584679},{s:616,b:4.97,a:5.03,l:4.99,v:33746,d:0.45,iv:0.1759,oi:169696},{s:617,b:4.49,a:4.56,l:4.52,v:29551,d:0.42,iv:0.1776,oi:133762},{s:618,b:4.57,a:4.66,l:4.63,v:26217,d:0.41,iv:0.1793,oi:195971},{s:619,b:3.55,a:3.59,l:3.55,v:41937,d:0.37,iv:0.1809,oi:198400},{s:620,b:2.93,a:2.98,l:2.96,v:60704,d:0.33,iv:0.1756,oi:520232},{s:621,b:2.71,a:2.76,l:2.73,v:30180,d:0.31,iv:0.1773,oi:233866},{s:622,b:2.66,a:2.74,l:2.7,v:20115,d:0.3,iv:0.179,oi:106461},{s:623,b:2.06,a:2.12,l:2.09,v:29138,d:0.26,iv:0.1737,oi:187741},{s:624,b:2.44,a:2.52,l:2.46,v:17121,d:0.27,iv:0.1754,oi:86348},{s:625,b:2.44,a:2.54,l:2.48,v:31540,d:0.26,iv:0.1771,oi:537083},{s:626,b:2.23,a:2.3,l:2.28,v:17607,d:0.24,iv:0.1788,oi:142594},{s:627,b:1.38,a:1.45,l:1.42,v:18057,d:0.18,iv:0.1736,oi:194671},{s:628,b:1.29,a:1.39,l:1.36,v:16671,d:0.17,iv:0.1753,oi:126508}],p:[{s:598,b:0.84,a:0.88,l:0.85,v:13225,d:-0.12,iv:0.1893,oi:161613},{s:599,b:1.37,a:1.4,l:1.38,v:21476,d:-0.16,iv:0.1838,oi:165376},{s:600,b:1.42,a:1.46,l:1.43,v:43762,d:-0.17,iv:0.1854,oi:169079},{s:601,b:1.71,a:1.8,l:1.76,v:21723,d:-0.2,iv:0.1869,oi:74679},{s:602,b:2.2,a:2.25,l:2.24,v:14669,d:-0.23,iv:0.1815,oi:144787},{s:603,b:2.03,a:2.08,l:2.07,v:31610,d:-0.23,iv:0.183,oi:146735},{s:604,b:2.59,a:2.63,l:2.61,v:24958,d:-0.26,iv:0.1846,oi:192912},{s:605,b:2.34,a:2.38,l:2.35,v:39179,d:-0.26,iv:0.1862,oi:494267},{s:606,b:2.32,a:2.38,l:2.37,v:35746,d:-0.28,iv:0.1807,oi:174635},{s:607,b:3.68,a:3.74,l:3.71,v:34512,d:-0.33,iv:0.1823,oi:176904},{s:608,b:3.65,a:3.71,l:3.7,v:27758,d:-0.35,iv:0.1839,oi:221095},{s:609,b:3.6,a:3.69,l:3.65,v:45177,d:-0.36,iv:0.1785,oi:230162},{s:610,b:3.68,a:3.77,l:3.73,v:46763,d:-0.38,iv:0.1801,oi:598960},{s:611,b:5.08,a:5.14,l:5.12,v:32645,d:-0.42,iv:0.1817,oi:224604},{s:612,b:4.8,a:4.87,l:4.85,v:45820,d:-0.44,iv:0.1834,oi:168295},{s:613,b:5.82,a:5.87,l:5.84,v:45752,d:-0.47,iv:0.178,oi:290312},{s:614,b:6.27,a:6.32,l:6.31,v:49748,d:-0.5,iv:0.1796,oi:146569},{s:615,b:6.73,a:6.78,l:6.75,v:80535,d:-0.52,iv:0.1813,oi:331954},{s:616,b:7.05,a:7.11,l:7.09,v:23744,d:-0.55,iv:0.1759,oi:151271},{s:617,b:7.56,a:7.64,l:7.61,v:27381,d:-0.58,iv:0.1776,oi:126812},{s:618,b:8.67,a:8.71,l:8.7,v:44098,d:-0.59,iv:0.1793,oi:238110},{s:619,b:8.62,a:8.67,l:8.64,v:25346,d:-0.63,iv:0.1809,oi:172770},{s:620,b:9.01,a:9.06,l:9.05,v:50931,d:-0.67,iv:0.1756,oi:388663},{s:621,b:9.78,a:9.83,l:9.81,v:28066,d:-0.69,iv:0.1773,oi:225840},{s:622,b:10.74,a:10.81,l:10.79,v:21309,d:-0.7,iv:0.179,oi:170451},{s:623,b:11.14,a:11.18,l:11.15,v:32191,d:-0.74,iv:0.1737,oi:203622},{s:624,b:12.54,a:12.57,l:12.55,v:30027,d:-0.73,iv:0.1754,oi:124609},{s:625,b:13.53,a:13.59,l:13.55,v:26310,d:-0.74,iv:0.1771,oi:200359},{s:626,b:14.29,a:14.37,l:14.34,v:26132,d:-0.76,iv:0.1788,oi:138440},{s:627,b:14.46,a:14.51,l:14.47,v:17614,d:-0.82,iv:0.1736,oi:130711},{s:628,b:15.38,a:15.43,l:15.4,v:13561,d:-0.83,iv:0.1753,oi:185378}]},
"AAPL":{c:[{s:250,b:24.14,a:24.2,l:24.17,v:2250,d:1.0,iv:0.2801,oi:59203},{s:252.5,b:21.66,a:21.7,l:21.67,v:965,d:1.0,iv:0.2726,oi:28369},{s:255,b:19.15,a:19.22,l:19.18,v:2329,d:0.99,iv:0.2725,oi:63015},{s:257.5,b:16.7,a:16.77,l:16.72,v:3464,d:0.98,iv:0.2656,oi:33756},{s:260,b:14.29,a:14.34,l:14.31,v:4574,d:0.96,iv:0.259,oi:132222},{s:262.5,b:12.04,a:12.1,l:12.05,v:5547,d:0.91,iv:0.2528,oi:22024},{s:265,b:9.86,a:9.9,l:9.88,v:6351,d:0.85,iv:0.2538,oi:163132},{s:267.5,b:7.44,a:7.5,l:7.49,v:7010,d:0.81,iv:0.2481,oi:77134},{s:270,b:6.01,a:6.04,l:6.03,v:15689,d:0.69,iv:0.2428,oi:183651},{s:272.5,b:3.99,a:4.05,l:4.01,v:15916,d:0.59,iv:0.2447,oi:42404},{s:275,b:3.0,a:3.06,l:3.02,v:22323,d:0.47,iv:0.2399,oi:179753},{s:277.5,b:2.12,a:2.2,l:2.18,v:12876,d:0.36,iv:0.2355,oi:72919},{s:280,b:1.25,a:1.33,l:1.3,v:18556,d:0.26,iv:0.2313,oi:182603},{s:282.5,b:0.6,a:0.63,l:0.61,v:7826,d:0.15,iv:0.2344,oi:73505},{s:285,b:0.48,a:0.52,l:0.49,v:9368,d:0.12,iv:0.2309,oi:81686},{s:287.5,b:0.25,a:0.28,l:0.27,v:3877,d:0.07,iv:0.2276,oi:31543},{s:290,b:0.11,a:0.15,l:0.13,v:2480,d:0.04,iv:0.2316,oi:67662},{s:292.5,b:0.03,a:0.06,l:0.04,v:1950,d:0.02,iv:0.229,oi:15433},{s:295,b:0.03,a:0.06,l:0.04,v:2639,d:0.01,iv:0.2266,oi:37632},{s:297.5,b:0.01,a:0.02,l:0.02,v:1187,d:0.0,iv:0.2245,oi:18255},{s:300,b:0.01,a:0.02,l:0.01,v:1550,d:0.0,iv:0.2297,oi:25656}],p:[{s:250,b:0.01,a:0.02,l:0.01,v:1442,d:-0.0,iv:0.2801,oi:28326},{s:252.5,b:0.01,a:0.02,l:0.01,v:1480,d:-0.0,iv:0.2726,oi:24678},{s:255,b:0.01,a:0.03,l:0.02,v:3964,d:-0.01,iv:0.2725,oi:67951},{s:257.5,b:0.05,a:0.07,l:0.06,v:3412,d:-0.02,iv:0.2656,oi:27056},{s:260,b:0.13,a:0.15,l:0.14,v:5060,d:-0.04,iv:0.259,oi:143946},{s:262.5,b:0.37,a:0.41,l:0.39,v:3104,d:-0.09,iv:0.2528,oi:38890},{s:265,b:0.68,a:0.72,l:0.7,v:14890,d:-0.15,iv:0.2538,oi:126929},{s:267.5,b:0.76,a:0.82,l:0.8,v:9539,d:-0.19,iv:0.2481,oi:37447},{s:270,b:1.82,a:1.87,l:1.84,v:14219,d:-0.31,iv:0.2428,oi:172499},{s:272.5,b:2.31,a:2.36,l:2.32,v:15590,d:-0.41,iv:0.2447,oi:109928},{s:275,b:3.8,a:3.89,l:3.82,v:21391,d:-0.53,iv:0.2399,oi:155497},{s:277.5,b:5.43,a:5.51,l:5.48,v:13239,d:-0.64,iv:0.2355,oi:47359},{s:280,b:7.06,a:7.13,l:7.11,v:15430,d:-0.74,iv:0.2313,oi:138171},{s:282.5,b:8.88,a:8.96,l:8.92,v:5053,d:-0.85,iv:0.2344,oi:62443},{s:285,b:11.27,a:11.34,l:11.29,v:11769,d:-0.88,iv:0.2309,oi:105798},{s:287.5,b:13.54,a:13.6,l:13.57,v:2249,d:-0.93,iv:0.2276,oi:27481},{s:290,b:15.9,a:15.96,l:15.91,v:3387,d:-0.96,iv:0.2316,oi:117237},{s:292.5,b:18.32,a:18.37,l:18.33,v:2835,d:-0.98,iv:0.229,oi:20780},{s:295,b:20.81,a:20.87,l:20.84,v:3593,d:-0.99,iv:0.2266,oi:34210},{s:297.5,b:23.28,a:23.32,l:23.31,v:937,d:-1.0,iv:0.2245,oi:28393},{s:300,b:25.77,a:25.81,l:25.79,v:1281,d:-1.0,iv:0.2297,oi:48968}]},
"MSFT":{c:[{s:387.5,b:25.59,a:25.62,l:25.6,v:1227,d:0.99,iv:0.2442,oi:24512},{s:390,b:23.12,a:23.2,l:23.14,v:2799,d:0.98,iv:0.2394,oi:29425},{s:392.5,b:20.68,a:20.74,l:20.7,v:2266,d:0.97,iv:0.2347,oi:33000},{s:395,b:18.29,a:18.36,l:18.32,v:3490,d:0.95,iv:0.2372,oi:68665},{s:397.5,b:16.08,a:16.12,l:16.09,v:2770,d:0.91,iv:0.2327,oi:39458},{s:400,b:13.56,a:13.6,l:13.58,v:4924,d:0.9,iv:0.2284,oi:93347},{s:402.5,b:11.81,a:11.87,l:11.85,v:4798,d:0.82,iv:0.2242,oi:41433},{s:405,b:9.3,a:9.38,l:9.34,v:5167,d:0.79,iv:0.2271,oi:76838},{s:407.5,b:7.53,a:7.56,l:7.53,v:4466,d:0.71,iv:0.2232,oi:38920},{s:410,b:5.9,a:5.95,l:5.92,v:7643,d:0.62,iv:0.2194,oi:74058},{s:412.5,b:4.38,a:4.46,l:4.4,v:7857,d:0.53,iv:0.2227,oi:44447},{s:415,b:3.63,a:3.67,l:3.65,v:10281,d:0.44,iv:0.2191,oi:134838},{s:417.5,b:2.64,a:2.69,l:2.65,v:4402,d:0.35,iv:0.2156,oi:47677},{s:420,b:1.8,a:1.88,l:1.85,v:5631,d:0.27,iv:0.2123,oi:106465},{s:422.5,b:1.28,a:1.37,l:1.33,v:5086,d:0.21,iv:0.2161,oi:19936},{s:425,b:0.79,a:0.81,l:0.8,v:6351,d:0.14,iv:0.213,oi:84364},{s:427.5,b:0.77,a:0.8,l:0.79,v:2684,d:0.13,iv:0.21,oi:17654},{s:430,b:0.24,a:0.28,l:0.25,v:4376,d:0.06,iv:0.2141,oi:87371},{s:432.5,b:0.18,a:0.22,l:0.2,v:2611,d:0.04,iv:0.2114,oi:14184},{s:435,b:0.09,a:0.14,l:0.12,v:2564,d:0.03,iv:0.2088,oi:87120},{s:437.5,b:0.07,a:0.08,l:0.07,v:1797,d:0.02,iv:0.2063,oi:13321}],p:[{s:387.5,b:0.01,a:0.03,l:0.02,v:2164,d:-0.01,iv:0.2442,oi:23147},{s:390,b:0.06,a:0.08,l:0.07,v:1954,d:-0.02,iv:0.2394,oi:60378},{s:392.5,b:0.1,a:0.14,l:0.12,v:2942,d:-0.03,iv:0.2347,oi:29243},{s:395,b:0.21,a:0.26,l:0.23,v:4536,d:-0.05,iv:0.2372,oi:44066},{s:397.5,b:0.5,a:0.52,l:0.51,v:2303,d:-0.09,iv:0.2327,oi:26512},{s:400,b:0.48,a:0.5,l:0.49,v:6929,d:-0.1,iv:0.2284,oi:81074},{s:402.5,b:1.23,a:1.26,l:1.25,v:2958,d:-0.18,iv:0.2242,oi:48972},{s:405,b:1.21,a:1.27,l:1.23,v:9054,d:-0.21,iv:0.2271,oi:126399},{s:407.5,b:1.9,a:1.98,l:1.95,v:6412,d:-0.29,iv:0.2232,oi:29563},{s:410,b:2.78,a:2.86,l:2.82,v:10502,d:-0.38,iv:0.2194,oi:98730},{s:412.5,b:3.78,a:3.84,l:3.82,v:12225,d:-0.47,iv:0.2227,oi:26869},{s:415,b:5.52,a:5.57,l:5.54,v:11027,d:-0.56,iv:0.2191,oi:129351},{s:417.5,b:7.02,a:7.09,l:7.07,v:5200,d:-0.65,iv:0.2156,oi:42491},{s:420,b:8.69,a:8.76,l:8.71,v:11236,d:-0.73,iv:0.2123,oi:100695},{s:422.5,b:10.68,a:10.74,l:10.72,v:4198,d:-0.79,iv:0.2161,oi:39691},{s:425,b:12.66,a:12.71,l:12.68,v:10337,d:-0.86,iv:0.213,oi:120209},{s:427.5,b:15.14,a:15.2,l:15.16,v:4676,d:-0.87,iv:0.21,oi:24673},{s:430,b:17.11,a:17.17,l:17.16,v:3977,d:-0.94,iv:0.2141,oi:85482},{s:432.5,b:19.55,a:19.6,l:19.59,v:3090,d:-0.96,iv:0.2114,oi:15646},{s:435,b:21.97,a:22.01,l:21.99,v:4704,d:-0.97,iv:0.2088,oi:38498},{s:437.5,b:24.43,a:24.47,l:24.44,v:1247,d:-0.98,iv:0.2063,oi:27345}]},
"NVDA":{c:[{s:165,b:24.46,a:24.51,l:24.49,v:898,d:1.0,iv:0.4843,oi:52779},{s:167.5,b:21.99,a:22.03,l:22.01,v:603,d:0.99,iv:0.4739,oi:24902},{s:170,b:19.54,a:19.6,l:19.56,v:2324,d:0.98,iv:0.4576,oi:46728},{s:172.5,b:17.07,a:17.14,l:17.09,v:1320,d:0.97,iv:0.4422,oi:37704},{s:175,b:14.71,a:14.76,l:14.72,v:3749,d:0.94,iv:0.4278,oi:91159},{s:177.5,b:12.46,a:12.54,l:12.48,v:4149,d:0.9,iv:0.4215,oi:49988},{s:180,b:10.23,a:10.3,l:10.27,v:8210,d:0.85,iv:0.4091,oi:54875},{s:182.5,b:8.38,a:8.43,l:8.4,v:8329,d:0.77,iv:0.3977,oi:79941},{s:185,b:6.47,a:6.5,l:6.49,v:22237,d:0.69,iv:0.3943,oi:237305},{s:187.5,b:5.0,a:5.04,l:5.01,v:9422,d:0.59,iv:0.3849,oi:119875},{s:190,b:3.65,a:3.73,l:3.69,v:38112,d:0.49,iv:0.3766,oi:248725},{s:192.5,b:2.6,a:2.64,l:2.62,v:9844,d:0.39,iv:0.3692,oi:72392},{s:195,b:1.78,a:1.82,l:1.8,v:16069,d:0.3,iv:0.3698,oi:156005},{s:197.5,b:1.28,a:1.34,l:1.31,v:3424,d:0.23,iv:0.3644,oi:27994},{s:200,b:0.76,a:0.8,l:0.78,v:6535,d:0.16,iv:0.36,oi:118374},{s:202.5,b:0.49,a:0.53,l:0.51,v:2374,d:0.11,iv:0.3636,oi:24663},{s:205,b:0.24,a:0.29,l:0.28,v:3775,d:0.06,iv:0.3612,oi:99842},{s:207.5,b:0.12,a:0.18,l:0.16,v:998,d:0.04,iv:0.3598,oi:14927},{s:210,b:0.11,a:0.16,l:0.14,v:1601,d:0.03,iv:0.3594,oi:62817},{s:212.5,b:0.07,a:0.09,l:0.08,v:367,d:0.02,iv:0.367,oi:11571},{s:215,b:0.01,a:0.03,l:0.02,v:417,d:0.01,iv:0.3686,oi:31945}],p:[{s:165,b:0.01,a:0.02,l:0.01,v:521,d:-0.0,iv:0.4843,oi:21526},{s:167.5,b:0.03,a:0.04,l:0.04,v:497,d:-0.01,iv:0.4739,oi:15392},{s:170,b:0.08,a:0.1,l:0.09,v:1173,d:-0.02,iv:0.4576,oi:59558},{s:172.5,b:0.1,a:0.15,l:0.11,v:1741,d:-0.03,iv:0.4422,oi:14582},{s:175,b:0.24,a:0.27,l:0.25,v:2779,d:-0.06,iv:0.4278,oi:82848},{s:177.5,b:0.5,a:0.53,l:0.51,v:3136,d:-0.1,iv:0.4215,oi:31381},{s:180,b:0.77,a:0.79,l:0.79,v:6360,d:-0.15,iv:0.4091,oi:98061},{s:182.5,b:1.37,a:1.46,l:1.42,v:7070,d:-0.23,iv:0.3977,oi:66107},{s:185,b:1.97,a:2.02,l:2.0,v:13368,d:-0.31,iv:0.3943,oi:237936},{s:187.5,b:2.99,a:3.07,l:3.05,v:9503,d:-0.41,iv:0.3849,oi:123991},{s:190,b:4.18,a:4.21,l:4.2,v:30089,d:-0.51,iv:0.3766,oi:362812},{s:192.5,b:5.6,a:5.65,l:5.63,v:14301,d:-0.61,iv:0.3692,oi:52933},{s:195,b:7.28,a:7.32,l:7.3,v:16584,d:-0.7,iv:0.3698,oi:275339},{s:197.5,b:9.27,a:9.34,l:9.29,v:6261,d:-0.77,iv:0.3644,oi:38526},{s:200,b:11.25,a:11.31,l:11.28,v:4029,d:-0.84,iv:0.36,oi:66857},{s:202.5,b:13.48,a:13.53,l:13.5,v:2055,d:-0.89,iv:0.3636,oi:47653},{s:205,b:15.72,a:15.79,l:15.78,v:2645,d:-0.94,iv:0.3612,oi:98602},{s:207.5,b:18.12,a:18.17,l:18.14,v:1005,d:-0.96,iv:0.3598,oi:13410},{s:210,b:20.59,a:20.66,l:20.64,v:1130,d:-0.97,iv:0.3594,oi:53963},{s:212.5,b:23.05,a:23.08,l:23.06,v:371,d:-0.98,iv:0.367,oi:22249},{s:215,b:25.48,a:25.53,l:25.51,v:734,d:-0.99,iv:0.3686,oi:43552}]},
"TSLA":{c:[{s:375,b:50.05,a:50.08,l:50.05,v:1698,d:0.96,iv:0.5984,oi:61087},{s:380,b:45.2,a:45.25,l:45.23,v:1649,d:0.95,iv:0.5849,oi:63348},{s:385,b:40.46,a:40.5,l:40.47,v:995,d:0.93,iv:0.5654,oi:22394},{s:390,b:36.0,a:36.06,l:36.02,v:3887,d:0.9,iv:0.5538,oi:131240},{s:395,b:31.74,a:31.82,l:31.79,v:4029,d:0.86,iv:0.5433,oi:52316},{s:400,b:27.59,a:27.65,l:27.61,v:9533,d:0.82,iv:0.5268,oi:158962},{s:405,b:24.13,a:24.19,l:24.15,v:4069,d:0.76,iv:0.5182,oi:61868},{s:410,b:19.95,a:20.03,l:19.98,v:18811,d:0.71,iv:0.5037,oi:180974},{s:415,b:17.07,a:17.14,l:17.12,v:12707,d:0.64,iv:0.4971,oi:93219},{s:420,b:14.08,a:14.13,l:14.11,v:28016,d:0.58,iv:0.4846,oi:231340},{s:425,b:11.62,a:11.68,l:11.66,v:43836,d:0.51,iv:0.48,oi:297273},{s:430,b:9.44,a:9.51,l:9.47,v:22943,d:0.44,iv:0.4764,oi:216653},{s:435,b:7.18,a:7.21,l:7.2,v:14699,d:0.37,iv:0.4669,oi:44528},{s:440,b:5.89,a:5.96,l:5.91,v:11974,d:0.32,iv:0.4653,oi:198364},{s:445,b:4.31,a:4.37,l:4.35,v:7985,d:0.26,iv:0.4577,oi:56381},{s:450,b:3.24,a:3.32,l:3.3,v:8449,d:0.21,iv:0.4582,oi:76061},{s:455,b:2.78,a:2.87,l:2.85,v:1953,d:0.18,iv:0.4526,oi:42258},{s:460,b:2.03,a:2.09,l:2.05,v:2787,d:0.14,iv:0.455,oi:109578},{s:465,b:1.47,a:1.54,l:1.49,v:1000,d:0.11,iv:0.4584,oi:21638},{s:470,b:1.11,a:1.16,l:1.15,v:1183,d:0.08,iv:0.4558,oi:83211},{s:475,b:0.79,a:0.82,l:0.81,v:1308,d:0.06,iv:0.4612,oi:71700}],p:[{s:375,b:0.44,a:0.48,l:0.46,v:831,d:-0.04,iv:0.5984,oi:68078},{s:380,b:0.6,a:0.63,l:0.61,v:2039,d:-0.05,iv:0.5849,oi:46518},{s:385,b:0.85,a:0.88,l:0.86,v:1927,d:-0.07,iv:0.5654,oi:41968},{s:390,b:1.37,a:1.46,l:1.41,v:2498,d:-0.1,iv:0.5538,oi:50620},{s:395,b:2.13,a:2.19,l:2.16,v:2140,d:-0.14,iv:0.5433,oi:38496},{s:400,b:2.96,a:3.03,l:2.98,v:9059,d:-0.18,iv:0.5268,oi:179460},{s:405,b:4.5,a:4.56,l:4.53,v:7189,d:-0.24,iv:0.5182,oi:67144},{s:410,b:5.33,a:5.38,l:5.36,v:17169,d:-0.29,iv:0.5037,oi:201358},{s:415,b:7.44,a:7.5,l:7.45,v:15270,d:-0.36,iv:0.4971,oi:105573},{s:420,b:9.43,a:9.5,l:9.46,v:24081,d:-0.42,iv:0.4846,oi:252650},{s:425,b:11.97,a:12.04,l:12.01,v:35759,d:-0.49,iv:0.48,oi:350323},{s:430,b:14.8,a:14.85,l:14.84,v:35150,d:-0.56,iv:0.4764,oi:360059},{s:435,b:17.52,a:17.57,l:17.56,v:13987,d:-0.63,iv:0.4669,oi:47564},{s:440,b:21.23,a:21.3,l:21.25,v:15268,d:-0.68,iv:0.4653,oi:100324},{s:445,b:24.66,a:24.7,l:24.69,v:5132,d:-0.74,iv:0.4577,oi:72444},{s:450,b:28.59,a:28.63,l:28.61,v:5638,d:-0.79,iv:0.4582,oi:115327},{s:455,b:33.14,a:33.17,l:33.15,v:2263,d:-0.82,iv:0.4526,oi:56271},{s:460,b:37.36,a:37.4,l:37.37,v:2516,d:-0.86,iv:0.455,oi:100914},{s:465,b:41.79,a:41.86,l:41.81,v:1818,d:-0.89,iv:0.4584,oi:26927},{s:470,b:46.44,a:46.47,l:46.46,v:1193,d:-0.92,iv:0.4558,oi:78578},{s:475,b:51.1,a:51.14,l:51.11,v:1302,d:-0.94,iv:0.4612,oi:33117}]},
"AMZN":{c:[{s:160,b:48.52,a:48.59,l:48.56,v:36,d:1.0,iv:0.4746,oi:2183},{s:165,b:43.55,a:43.58,l:43.56,v:30,d:1.0,iv:0.4401,oi:1691},{s:170,b:38.53,a:38.6,l:38.58,v:34,d:1.0,iv:0.415,oi:4651},{s:175,b:33.55,a:33.6,l:33.59,v:114,d:1.0,iv:0.3854,oi:8120},{s:180,b:28.55,a:28.6,l:28.56,v:254,d:1.0,iv:0.3652,oi:9414},{s:185,b:23.55,a:23.61,l:23.6,v:179,d:1.0,iv:0.3474,oi:8689},{s:190,b:18.56,a:18.61,l:18.59,v:1236,d:1.0,iv:0.325,oi:34848},{s:195,b:13.67,a:13.72,l:13.69,v:1244,d:0.97,iv:0.3121,oi:17948},{s:200,b:9.04,a:9.11,l:9.09,v:3378,d:0.88,iv:0.2946,oi:60626},{s:205,b:5.17,a:5.22,l:5.18,v:5463,d:0.69,iv:0.2865,oi:32387},{s:210,b:2.15,a:2.22,l:2.16,v:12999,d:0.43,iv:0.2738,oi:115854},{s:215,b:0.83,a:0.88,l:0.87,v:2846,d:0.21,iv:0.2706,oi:19506},{s:220,b:0.16,a:0.19,l:0.18,v:3400,d:0.06,iv:0.2698,oi:48506},{s:225,b:0.03,a:0.05,l:0.04,v:1409,d:0.02,iv:0.2644,oi:50189},{s:230,b:0.01,a:0.02,l:0.01,v:706,d:0.0,iv:0.2685,oi:29119},{s:235,b:0.01,a:0.02,l:0.01,v:190,d:0.0,iv:0.268,oi:6846},{s:240,b:0.01,a:0.02,l:0.01,v:172,d:0.0,iv:0.2769,oi:12318},{s:245,b:0.01,a:0.02,l:0.01,v:45,d:0.0,iv:0.2812,oi:3818},{s:250,b:0.01,a:0.02,l:0.01,v:42,d:0.0,iv:0.295,oi:6991},{s:255,b:0.01,a:0.02,l:0.02,v:18,d:0.0,iv:0.3111,oi:1621},{s:260,b:0.01,a:0.02,l:0.01,v:37,d:0.0,iv:0.3227,oi:2721}],p:[{s:160,b:0.01,a:0.02,l:0.01,v:35,d:-0.0,iv:0.4746,oi:3534},{s:165,b:0.01,a:0.02,l:0.01,v:36,d:-0.0,iv:0.4401,oi:1420},{s:170,b:0.01,a:0.02,l:0.01,v:40,d:-0.0,iv:0.415,oi:6139},{s:175,b:0.01,a:0.02,l:0.01,v:167,d:-0.0,iv:0.3854,oi:9648},{s:180,b:0.01,a:0.02,l:0.01,v:177,d:-0.0,iv:0.3652,oi:8639},{s:185,b:0.01,a:0.02,l:0.01,v:172,d:-0.0,iv:0.3474,oi:4067},{s:190,b:0.01,a:0.02,l:0.01,v:1276,d:-0.0,iv:0.325,oi:19768},{s:195,b:0.09,a:0.12,l:0.11,v:1540,d:-0.03,iv:0.3121,oi:15159},{s:200,b:0.47,a:0.5,l:0.48,v:3338,d:-0.12,iv:0.2946,oi:29970},{s:205,b:1.57,a:1.62,l:1.59,v:6247,d:-0.31,iv:0.2865,oi:21593},{s:210,b:3.57,a:3.6,l:3.59,v:14363,d:-0.57,iv:0.2738,oi:153310},{s:215,b:7.22,a:7.28,l:7.26,v:3232,d:-0.79,iv:0.2706,oi:25749},{s:220,b:11.54,a:11.59,l:11.57,v:2650,d:-0.94,iv:0.2698,oi:28378},{s:225,b:16.4,a:16.45,l:16.42,v:1261,d:-0.98,iv:0.2644,oi:31927},{s:230,b:21.36,a:21.42,l:21.41,v:802,d:-1.0,iv:0.2685,oi:10825},{s:235,b:26.35,a:26.41,l:26.37,v:234,d:-1.0,iv:0.268,oi:2991},{s:240,b:31.34,a:31.4,l:31.36,v:214,d:-1.0,iv:0.2769,oi:9271},{s:245,b:36.33,a:36.41,l:36.37,v:44,d:-1.0,iv:0.2812,oi:3317},{s:250,b:41.34,a:41.39,l:41.36,v:33,d:-1.0,iv:0.295,oi:8242},{s:255,b:46.33,a:46.39,l:46.34,v:37,d:-1.0,iv:0.3111,oi:2000},{s:260,b:51.32,a:51.39,l:51.37,v:25,d:-1.0,iv:0.3227,oi:1722}]},
"GOOG":{c:[{s:135,b:50.52,a:50.57,l:50.56,v:22,d:1.0,iv:0.5045,oi:738},{s:140,b:45.53,a:45.57,l:45.57,v:44,d:1.0,iv:0.4635,oi:2585},{s:145,b:40.52,a:40.59,l:40.56,v:20,d:1.0,iv:0.4325,oi:877},{s:150,b:35.53,a:35.59,l:35.56,v:32,d:1.0,iv:0.4045,oi:2384},{s:155,b:30.53,a:30.6,l:30.55,v:31,d:1.0,iv:0.3725,oi:2046},{s:160,b:25.54,a:25.6,l:25.57,v:93,d:1.0,iv:0.3505,oi:8708},{s:165,b:20.54,a:20.6,l:20.58,v:202,d:1.0,iv:0.3244,oi:6509},{s:170,b:15.54,a:15.61,l:15.57,v:920,d:1.0,iv:0.3084,oi:25613},{s:175,b:10.62,a:10.69,l:10.65,v:2027,d:0.97,iv:0.2884,oi:37788},{s:180,b:6.06,a:6.12,l:6.1,v:4895,d:0.84,iv:0.2783,oi:52229},{s:185,b:2.48,a:2.56,l:2.54,v:4516,d:0.55,iv:0.2712,oi:31307},{s:190,b:0.66,a:0.72,l:0.69,v:2961,d:0.22,iv:0.2601,oi:36043},{s:195,b:0.11,a:0.14,l:0.13,v:1592,d:0.05,iv:0.2591,oi:15879},{s:200,b:0.01,a:0.02,l:0.01,v:848,d:0.01,iv:0.254,oi:20869},{s:205,b:0.01,a:0.02,l:0.01,v:172,d:0.0,iv:0.2589,oi:4294},{s:210,b:0.01,a:0.02,l:0.01,v:154,d:0.0,iv:0.2597,oi:16333},{s:215,b:0.01,a:0.02,l:0.01,v:54,d:0.0,iv:0.2706,oi:2706},{s:220,b:0.01,a:0.02,l:0.01,v:47,d:0.0,iv:0.2845,oi:7544},{s:225,b:0.01,a:0.02,l:0.01,v:18,d:0.0,iv:0.2943,oi:3730},{s:230,b:0.01,a:0.02,l:0.02,v:35,d:0.0,iv:0.3142,oi:2887},{s:235,b:0.01,a:0.02,l:0.01,v:48,d:0.0,iv:0.33,oi:740}],p:[{s:135,b:0.01,a:0.02,l:0.01,v:40,d:0.0,iv:0.5045,oi:745},{s:140,b:0.01,a:0.02,l:0.01,v:50,d:0.0,iv:0.4635,oi:1211},{s:145,b:0.01,a:0.02,l:0.01,v:49,d:-0.0,iv:0.4325,oi:669},{s:150,b:0.01,a:0.02,l:0.01,v:27,d:-0.0,iv:0.4045,oi:7333},{s:155,b:0.01,a:0.02,l:0.01,v:41,d:-0.0,iv:0.3725,oi:1476},{s:160,b:0.01,a:0.02,l:0.01,v:179,d:-0.0,iv:0.3505,oi:16165},{s:165,b:0.01,a:0.02,l:0.01,v:183,d:-0.0,iv:0.3244,oi:7366},{s:170,b:0.01,a:0.02,l:0.01,v:578,d:-0.0,iv:0.3084,oi:32071},{s:175,b:0.07,a:0.09,l:0.08,v:1712,d:-0.03,iv:0.2884,oi:46550},{s:180,b:0.49,a:0.52,l:0.52,v:3094,d:-0.16,iv:0.2783,oi:56749},{s:185,b:1.9,a:1.96,l:1.91,v:6702,d:-0.45,iv:0.2712,oi:20891},{s:190,b:5.07,a:5.12,l:5.09,v:3754,d:-0.78,iv:0.2601,oi:58932},{s:195,b:9.5,a:9.55,l:9.52,v:788,d:-0.95,iv:0.2591,oi:17983},{s:200,b:14.38,a:14.44,l:14.42,v:1018,d:-0.99,iv:0.254,oi:21019},{s:205,b:19.36,a:19.43,l:19.37,v:189,d:-1.0,iv:0.2589,oi:4696},{s:210,b:24.36,a:24.41,l:24.39,v:254,d:-1.0,iv:0.2597,oi:5433},{s:215,b:29.37,a:29.4,l:29.38,v:45,d:-1.0,iv:0.2706,oi:3274},{s:220,b:34.36,a:34.4,l:34.37,v:43,d:-1.0,iv:0.2845,oi:4415},{s:225,b:39.36,a:39.39,l:39.37,v:50,d:-1.0,iv:0.2943,oi:3081},{s:230,b:44.35,a:44.4,l:44.38,v:48,d:-1.0,iv:0.3142,oi:1247},{s:235,b:49.33,a:49.41,l:49.38,v:23,d:-1.0,iv:0.33,oi:616}]},
"META":{c:[{s:650,b:49.36,a:49.43,l:49.41,v:2370,d:0.97,iv:0.3403,oi:65936},{s:655,b:44.41,a:44.48,l:44.44,v:1736,d:0.96,iv:0.3314,oi:12696},{s:660,b:40.02,a:40.07,l:40.04,v:2132,d:0.92,iv:0.3298,oi:81180},{s:665,b:35.52,a:35.59,l:35.54,v:2746,d:0.89,iv:0.3214,oi:17480},{s:670,b:30.69,a:30.76,l:30.71,v:4483,d:0.88,iv:0.3202,oi:72427},{s:675,b:26.2,a:26.28,l:26.23,v:4836,d:0.84,iv:0.3193,oi:100506},{s:680,b:23.03,a:23.07,l:23.05,v:5546,d:0.76,iv:0.3116,oi:119319},{s:685,b:18.81,a:18.84,l:18.83,v:4700,d:0.71,iv:0.3111,oi:51429},{s:690,b:15.24,a:15.3,l:15.27,v:13366,d:0.65,iv:0.3038,oi:52196},{s:695,b:13.63,a:13.67,l:13.64,v:8971,d:0.56,iv:0.3038,oi:59318},{s:700,b:10.59,a:10.64,l:10.61,v:9944,d:0.5,iv:0.297,oi:72931},{s:705,b:7.95,a:8.02,l:7.98,v:7388,d:0.42,iv:0.2974,oi:24679},{s:710,b:6.92,a:6.97,l:6.94,v:9629,d:0.36,iv:0.2981,oi:47122},{s:715,b:4.59,a:4.67,l:4.65,v:5705,d:0.28,iv:0.292,oi:19572},{s:720,b:3.45,a:3.53,l:3.48,v:7224,d:0.23,iv:0.2931,oi:101998},{s:725,b:2.85,a:2.9,l:2.88,v:4986,d:0.19,iv:0.2875,oi:56152},{s:730,b:1.71,a:1.76,l:1.72,v:4202,d:0.13,iv:0.2891,oi:55481},{s:735,b:1.28,a:1.37,l:1.34,v:1945,d:0.1,iv:0.2839,oi:24466},{s:740,b:0.69,a:0.74,l:0.73,v:2407,d:0.06,iv:0.2859,oi:38457},{s:745,b:0.51,a:0.57,l:0.56,v:1407,d:0.05,iv:0.2882,oi:9650},{s:750,b:0.44,a:0.46,l:0.45,v:1731,d:0.04,iv:0.2837,oi:72144}],p:[{s:650,b:0.31,a:0.36,l:0.34,v:2407,d:-0.03,iv:0.3403,oi:62127},{s:655,b:0.37,a:0.39,l:0.38,v:1996,d:-0.04,iv:0.3314,oi:26099},{s:660,b:0.96,a:1.0,l:0.98,v:2996,d:-0.08,iv:0.3298,oi:53385},{s:665,b:1.43,a:1.53,l:1.49,v:2933,d:-0.11,iv:0.3214,oi:32263},{s:670,b:1.61,a:1.68,l:1.65,v:3522,d:-0.12,iv:0.3202,oi:52259},{s:675,b:2.12,a:2.2,l:2.14,v:5007,d:-0.16,iv:0.3193,oi:69714},{s:680,b:3.92,a:4.0,l:3.93,v:7600,d:-0.24,iv:0.3116,oi:51463},{s:685,b:4.72,a:4.75,l:4.73,v:6825,d:-0.29,iv:0.3111,oi:55860},{s:690,b:6.15,a:6.19,l:6.17,v:11971,d:-0.35,iv:0.3038,oi:108789},{s:695,b:9.53,a:9.57,l:9.54,v:10126,d:-0.44,iv:0.3038,oi:24433},{s:700,b:11.48,a:11.54,l:11.52,v:11308,d:-0.5,iv:0.297,oi:207359},{s:705,b:13.85,a:13.91,l:13.87,v:4980,d:-0.58,iv:0.2974,oi:31124},{s:710,b:17.8,a:17.87,l:17.85,v:11792,d:-0.64,iv:0.2981,oi:76136},{s:715,b:20.48,a:20.54,l:20.49,v:6708,d:-0.72,iv:0.292,oi:49978},{s:720,b:24.34,a:24.4,l:24.38,v:5962,d:-0.77,iv:0.2931,oi:62068},{s:725,b:28.71,a:28.78,l:28.72,v:7214,d:-0.81,iv:0.2875,oi:79079},{s:730,b:32.57,a:32.63,l:32.61,v:3041,d:-0.87,iv:0.2891,oi:80890},{s:735,b:37.16,a:37.22,l:37.18,v:1784,d:-0.9,iv:0.2839,oi:22879},{s:740,b:41.54,a:41.62,l:41.56,v:2917,d:-0.94,iv:0.2859,oi:53047},{s:745,b:46.36,a:46.43,l:46.41,v:977,d:-0.95,iv:0.2882,oi:15591},{s:750,b:51.27,a:51.34,l:51.3,v:1527,d:-0.96,iv:0.2837,oi:26605}]},
};

const DEMO_EXPIRATIONS = ['2026-02-13', '2026-02-14', '2026-02-17'];

// ==================== LIVE STATE ====================
const lp = {};
const liveFlow = {};
const liveUnusual = {};
const liveChains = {};
let availableExpirations = [];
let selectedChainTk = 'SPY';
let selectedChainExp = '';
let orderCt = 0, totalPrem = 0, feedAge = 0;
let connectionMode = 'demo'; // 'local', 'server', 'demo'
let isRealtime = false;

// ==================== DATA PROVIDER ====================
class DataProvider {
  constructor() {
    this.ws = null;
    this.callbacks = { quote: [], flow: [], chain: [], status: [], snapshot: [], expirations: [] };
    this.reconnectTimer = null;
    this.config = null;
  }

  on(event, cb) { if (this.callbacks[event]) this.callbacks[event].push(cb); }
  emit(event, ...args) { (this.callbacks[event] || []).forEach(cb => cb(...args)); }

  connect(mode, config) {
    this.config = { mode, ...config };
    const url = mode === 'local' ? 'ws://localhost:8765' : config.serverUrl;

    try {
      this.ws = new WebSocket(url);
    } catch (e) {
      this.emit('status', { status: 'error', msg: 'Invalid WebSocket URL' });
      return;
    }

    this.ws.onopen = () => {
      if (mode === 'server') {
        this.ws.send(JSON.stringify({
          app_key: config.appKey,
          username: config.username,
          password: config.password,
        }));
      }
      this.emit('status', { status: 'connecting', msg: 'WebSocket connected, waiting for data...' });
    };

    this.ws.onmessage = (event) => {
      try {
        const msg = JSON.parse(event.data);
        switch (msg.type) {
          case 'snapshot':
            this.emit('snapshot', msg);
            this.emit('status', { status: msg.status || 'connected', msg: msg.msg || 'Receiving data' });
            break;
          case 'quote_update':
            this.emit('quote', msg.ticker, msg.data);
            break;
          case 'flow_update':
            this.emit('flow', msg.ticker, msg.data);
            break;
          case 'chain_update':
            this.emit('chain', msg.ticker, msg.expiration, msg.data);
            break;
          case 'expirations_update':
            this.emit('expirations', msg.expirations);
            break;
          case 'status':
            this.emit('status', msg);
            break;
          case 'error':
            this.emit('status', { status: 'error', msg: msg.msg });
            break;
        }
      } catch (e) {
        console.error('WS parse error:', e);
      }
    };

    this.ws.onclose = () => {
      this.emit('status', { status: 'disconnected', msg: 'Connection lost' });
      // Auto-reconnect after 5s
      if (this.reconnectTimer) clearTimeout(this.reconnectTimer);
      this.reconnectTimer = setTimeout(() => {
        if (this.config) this.connect(this.config.mode, this.config);
      }, 5000);
    };

    this.ws.onerror = () => {
      this.emit('status', { status: 'error', msg: 'Connection error' });
    };
  }

  disconnect() {
    if (this.reconnectTimer) clearTimeout(this.reconnectTimer);
    this.reconnectTimer = null;
    this.config = null;
    if (this.ws) {
      this.ws.onclose = null; // prevent reconnect
      this.ws.close();
      this.ws = null;
    }
  }
}

let provider = null;

// ==================== UTILS ====================
const fmtN = n => { n = Number(n) || 0; return n >= 1e6 ? (n/1e6).toFixed(1)+'M' : n >= 1e3 ? (n/1e3).toFixed(1)+'K' : n.toFixed(0); };
const fmtD = n => (Number(n) || 0).toFixed(2);
const fmtP = n => {
  n = Number(n) || 0;
  if (n >= 1e6) return '$' + (n/1e6).toFixed(2) + 'M';
  if (n >= 1e3) return '$' + (n/1e3).toFixed(1) + 'K';
  return '$' + n.toFixed(0);
};
const sig = (d, t) => t === 'C' ? (d > 0.3 ? 'BULL' : d > 0 ? 'NEUT' : 'BEAR') : (Math.abs(d) > 0.3 ? 'BEAR' : 'NEUT');
const sigCls = s => s === 'BULL' ? 'badge-bull' : s === 'BEAR' ? 'badge-bear' : 'badge-neut';
const pcCls = r => r < 0.7 ? 'pc-bull' : r > 1.0 ? 'pc-bear' : 'pc-neut';
const fmtOI = n => { if (n == null) return '--'; n = Number(n); return n >= 1e3 ? (n/1e3).toFixed(1)+'K' : n.toFixed(0); };
const fmtIV = n => { if (n == null) return '--'; return (Number(n)*100).toFixed(1)+'%'; };

// ==================== RENDER ====================
function renderTickers() {
  const el = document.getElementById('tickerStrip');
  el.innerHTML = TICKERS.map(t => {
    const q = lp[t] || {};
    const last = q.last || 0; const chg = q.chg || 0;
    const cls = chg >= 0 ? 'up' : 'dn'; const s = chg >= 0 ? '+' : '';
    return `<div class="tk" id="tk-${t}"><div class="tk-sym">${t}</div><div class="tk-price" id="tp-${t}">${fmtD(last)}</div><div class="tk-chg ${cls}" id="tc-${t}">${s}${fmtD(chg)}</div><div class="tk-hilo">H: ${fmtD(q.hi||0)} L: ${fmtD(q.lo||0)}</div><div class="tk-vol">Vol ${fmtN(q.vol||0)}</div></div>`;
  }).join('');
}

function renderSentiment() {
  const el = document.getElementById('sentGrid');
  el.innerHTML = TICKERS.map(t => {
    const q = lp[t] || {};
    const f = liveFlow[t] || { cv: 0, pv: 0, pc: 0 };
    const tot = (f.cv || 0) + (f.pv || 0);
    const pct = tot > 0 ? ((f.cv || 0) / tot * 100).toFixed(0) : '50';
    const cls = pcCls(f.pc || 0);
    return `<div class="sent-card"><div class="sent-sym">${t}</div><div class="sent-price" id="sp-${t}">${fmtD(q.last||0)}</div><div class="sent-row"><span>Calls</span><span class="sent-val">${fmtN(f.cv||0)}</span></div><div class="sent-row"><span>Puts</span><span class="sent-val">${fmtN(f.pv||0)}</span></div><div class="sent-bar"><div class="sent-fill" style="width:${pct}%;background:var(--green)"></div></div><span class="pc-tag ${cls}">P/C ${(f.pc||0).toFixed(3)}</span></div>`;
  }).join('');
}

function buildFlowRows() {
  const rows = [];
  Object.keys(liveUnusual).forEach(tk => {
    (liveUnusual[tk] || []).forEach(a => {
      const prem = (a.v || 0) * (a.l || 0) * 100;
      const s = sig(a.d || 0, a.t);
      rows.push({ tk, t: a.t, s: a.s, l: a.l || 0, v: a.v || 0, d: a.d || 0, oi: a.oi || null, exp: a.exp || '', prem, sig: s });
    });
  });
  rows.sort((a, b) => b.prem - a.prem);
  orderCt = rows.length;
  totalPrem = rows.reduce((s, r) => s + r.prem, 0);
  return rows;
}

function renderFlow() {
  const rows = buildFlowRows();
  const tbody = document.getElementById('flowBody');
  tbody.innerHTML = rows.map(r => {
    const golden = r.prem > 5e6;
    const rc = r.t === 'C' ? 'call-row' : 'put-row';
    const bc = r.t === 'C' ? 'badge-c' : 'badge-p';
    const tl = r.t === 'C' ? 'CALL' : 'PUT';
    const sc = sigCls(r.sig);
    const gt = golden ? '<span class="golden-tag">\u2605</span>' : '';
    const expStr = r.exp ? `<span class="exp-tag">${r.exp}</span>` : '';
    return `<tr class="${golden?'golden-row':rc}"><td><b>${r.tk}</b></td><td>${expStr}</td><td><span class="badge ${bc}">${tl}</span></td><td>$${r.s}</td><td>${fmtD(r.l)}</td><td>${fmtN(r.v)}</td><td>${fmtOI(r.oi)}</td><td>${gt}<b>${fmtP(r.prem)}</b></td><td>${(r.d).toFixed(4)}</td><td><span class="${sc}">${r.sig}</span></td></tr>`;
  }).join('');
  document.getElementById('flowCount').textContent = rows.length + ' orders';
  document.getElementById('orderCt').textContent = orderCt.toLocaleString();
  document.getElementById('totalPrem').textContent = fmtP(totalPrem);
}

function renderChain() {
  const tk = selectedChainTk;
  const tkChains = liveChains[tk];
  if (!tkChains) return;
  // Pick selected expiration, or fall back to first available
  const data = (selectedChainExp && tkChains[selectedChainExp])
    ? tkChains[selectedChainExp]
    : Object.values(tkChains)[0];
  if (!data) return;
  const price = (lp[tk] || {}).last || 0;
  const tbody = document.getElementById('chainBody');
  const strikes = data.c.map(c => c.s);

  // Pad to at least 10 rows
  const minRows = Math.max(strikes.length, 10);

  tbody.innerHTML = strikes.map((strike, i) => {
    const c = data.c[i] || {};
    const p = data.p[i] || {};
    const isAtm = price > 0 && Math.abs(strike - price) < (CHAIN_CFG_JS[tk] || 1);
    const atmCls = isAtm ? 'atm' : '';
    const strikeCls = isAtm ? 'strike-col atm-strike' : 'strike-col';
    return `<tr class="${atmCls}"><td>${(c.d||0).toFixed(4)}</td><td>${fmtOI(c.oi)}</td><td>${fmtN(c.v||0)}</td><td style="color:var(--dim)">${fmtIV(c.iv)}</td><td id="cc-${tk}-${strike}">${fmtD(c.l||0)}</td><td>${c.b!=null?fmtD(c.b):'--'}</td><td class="${strikeCls}">${strike}</td><td>${p.b!=null?fmtD(p.b):'--'}</td><td id="cp-${tk}-${strike}">${fmtD(p.l||0)}</td><td style="color:var(--dim)">${fmtIV(p.iv)}</td><td>${fmtN(p.v||0)}</td><td>${fmtOI(p.oi)}</td><td>${(p.d||0).toFixed(4)}</td></tr>`;
  }).join('');

  document.getElementById('chainTitle').textContent = tk + ' Options Chain';
}

// ATM threshold per ticker for chain highlighting
const CHAIN_CFG_JS = { SPY: 1, QQQ: 1, AAPL: 2.5, MSFT: 2.5, NVDA: 2.5, TSLA: 2.5, AMZN: 2.5, GOOG: 2.5, META: 2.5 };

// ==================== CHARTS ====================
Chart.defaults.color = '#666';
Chart.defaults.borderColor = '#1a1a1a';
Chart.defaults.font.family = "'JetBrains Mono',monospace";
Chart.defaults.font.size = 10;

let pcChartInst, strikeInst, netInst, volDonutInst, premDonutInst;

function stampTs(id) {
  const el = document.getElementById(id);
  if (el) el.textContent = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
}

function renderPCChart() {
  const tk = TICKERS;
  const vals = tk.map(t => (liveFlow[t] || {}).pc || 0);
  const colors = vals.map(v => v < 0.7 ? '#4af6c3' : v > 1.0 ? '#ff433d' : '#fb8b1e');
  if (pcChartInst) pcChartInst.destroy();
  pcChartInst = new Chart(document.getElementById('pcChart'), {
    type: 'bar', data: { labels: tk, datasets: [{ data: vals, backgroundColor: colors, borderWidth: 0, borderRadius: 2, barThickness: 14 }] },
    options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, animation: false,
      plugins: { legend: { display: false } },
      scales: { x: { grid: { color: '#111' }, max: 1.5, ticks: { callback: v => v.toFixed(1) } }, y: { grid: { display: false }, ticks: { font: { weight: '600' } } } } }
  });
  stampTs('pcTs');
}

function renderDonuts() {
  const filter = document.getElementById('flowDistFilter')?.value || 'all';
  const filteredTickers = filter === 'all' ? TICKERS : [filter];
  let tcv = 0, tpv = 0, tcp = 0, tpp = 0;
  filteredTickers.forEach(t => { tcv += (liveFlow[t] || {}).cv || 0; tpv += (liveFlow[t] || {}).pv || 0; });
  filteredTickers.forEach(t => (liveUnusual[t] || []).forEach(a => { const p = (a.v||0) * (a.l||0) * 100; a.t === 'C' ? tcp += p : tpp += p; }));
  if (volDonutInst) volDonutInst.destroy();
  if (premDonutInst) premDonutInst.destroy();
  volDonutInst = new Chart(document.getElementById('volDonut'), {
    type: 'doughnut', data: { labels: ['Calls', 'Puts'], datasets: [{ data: [tcv, tpv], backgroundColor: ['#4af6c3', '#ff433d'], borderWidth: 0 }] },
    options: { responsive: true, maintainAspectRatio: false, animation: false, cutout: '65%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 8, padding: 4, font: { size: 9 } } } } }
  });
  premDonutInst = new Chart(document.getElementById('premDonut'), {
    type: 'doughnut', data: { labels: ['Call $', 'Put $'], datasets: [{ data: [tcp, tpp], backgroundColor: ['#4af6c3', '#ff433d'], borderWidth: 0 }] },
    options: { responsive: true, maintainAspectRatio: false, animation: false, cutout: '65%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 8, padding: 4, font: { size: 9 } } } } }
  });
  stampTs('flowDistTs');
}

function renderStrikeChart() {
  const tk = document.getElementById('strikeTk').value;
  const tkChains = liveChains[tk];
  if (!tkChains) return;
  const d = (selectedChainExp && tkChains[selectedChainExp])
    ? tkChains[selectedChainExp]
    : Object.values(tkChains)[0];
  if (!d) return;
  const strikes = d.c.map(c => c.s);
  const cv = d.c.map(c => c.v || 0);
  const pv = d.p.map(p => p.v || 0);
  if (strikeInst) strikeInst.destroy();
  strikeInst = new Chart(document.getElementById('strikeChart'), {
    type: 'bar', data: { labels: strikes, datasets: [{ label: 'Calls', data: cv, backgroundColor: '#4af6c3', borderWidth: 0, borderRadius: 1 }, { label: 'Puts', data: pv, backgroundColor: '#ff433d', borderWidth: 0, borderRadius: 1 }] },
    options: { responsive: true, maintainAspectRatio: false, animation: false, plugins: { legend: { labels: { boxWidth: 8, padding: 4 } } }, scales: { x: { grid: { color: '#111' } }, y: { grid: { color: '#111' } } } }
  });
  stampTs('strikeTs');
}

function renderNetFlow() {
  const tks = TICKERS;
  const bull = [], bear = [];
  tks.forEach(t => {
    let b = 0, r = 0;
    (liveUnusual[t] || []).forEach(a => {
      const p = (a.v||0) * (a.l||0) * 100;
      if (a.t === 'C' && a.d > 0.3) b += p;
      if (a.t === 'P' && Math.abs(a.d) > 0.3) r += p;
    });
    bull.push(b); bear.push(r);
  });
  if (netInst) netInst.destroy();
  netInst = new Chart(document.getElementById('netChart'), {
    type: 'bar', data: { labels: tks, datasets: [{ label: 'Bullish', data: bull, backgroundColor: '#4af6c3', borderWidth: 0, borderRadius: 1 }, { label: 'Bearish', data: bear, backgroundColor: '#ff433d', borderWidth: 0, borderRadius: 1 }] },
    options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, animation: false, plugins: { legend: { labels: { boxWidth: 8, padding: 4 } } }, scales: { x: { grid: { color: '#111' }, stacked: false }, y: { grid: { display: false }, stacked: false } } }
  });
  stampTs('netFlowTs');
}

function renderAllCharts() {
  renderPCChart();
  renderDonuts();
  renderStrikeChart();
  renderNetFlow();
}

// ==================== FILTERS ====================
function setupFilters() {
  document.querySelectorAll('.fbtn').forEach(b => {
    b.addEventListener('click', () => { document.querySelectorAll('.fbtn').forEach(x => x.classList.remove('on')); b.classList.add('on'); filterFlow(); });
  });
  document.getElementById('tkFilter').addEventListener('change', filterFlow);
  document.getElementById('expFilter').addEventListener('change', filterFlow);
}

function filterFlow() {
  const ft = document.querySelector('.fbtn.on')?.dataset.f || 'all';
  const tk = document.getElementById('tkFilter').value;
  const exp = document.getElementById('expFilter').value;
  document.querySelectorAll('#flowBody tr').forEach(r => {
    const rtk = r.cells[0].textContent;
    const rexp = r.cells[1]?.textContent || '';
    const rt = r.cells[2].textContent.includes('CALL') ? 'calls' : 'puts';
    let show = true;
    if (ft === 'calls' && rt !== 'calls') show = false;
    if (ft === 'puts' && rt !== 'puts') show = false;
    if (tk && rtk !== tk) show = false;
    if (exp && !rexp.includes(exp)) show = false;
    r.style.display = show ? '' : 'none';
  });
}

// ==================== EXPIRATION MANAGEMENT ====================
function updateExpirationDropdowns(exps) {
  availableExpirations = exps || [];
  const chainExpEl = document.getElementById('chainExp');
  const expFilterEl = document.getElementById('expFilter');

  // Chain expiration dropdown
  const prevChain = chainExpEl.value;
  chainExpEl.innerHTML = exps.map(e => `<option value="${e}">${e}</option>`).join('');
  if (prevChain && exps.includes(prevChain)) chainExpEl.value = prevChain;
  else if (exps.length > 0) { chainExpEl.value = exps[0]; selectedChainExp = exps[0]; }

  // Flow filter dropdown
  const prevFilter = expFilterEl.value;
  expFilterEl.innerHTML = '<option value="">ALL EXPIRATIONS</option>' + exps.map(e => `<option value="${e}">${e}</option>`).join('');
  if (prevFilter) expFilterEl.value = prevFilter;

  // Sentiment label
  document.getElementById('sentExpLabel').textContent = exps.length > 1 ? `${exps.length} Expirations` : (exps[0] || 'All Expirations');
}

// ==================== CONNECTION STATUS ====================
function updateConnectionStatus(status, mode, msg) {
  const el = document.getElementById('connStatus');
  const rtEl = document.getElementById('rtBadge');
  const feedDot = document.getElementById('feedDot');
  const feedLabel = document.getElementById('feedLabel');
  el.className = 'hdr-status';

  // Feed dot color: green=live, orange=delayed, red=disconnected, gray=demo
  if (feedDot) {
    if (status === 'connected') feedDot.style.background = 'var(--green)';
    else if (status === 'delayed') feedDot.style.background = 'var(--orange)';
    else if (status === 'disconnected' || status === 'error') feedDot.style.background = 'var(--red)';
    else feedDot.style.background = 'var(--dim)';
  }

  // Feed label text
  if (feedLabel) {
    if (msg === 'Market closed') feedLabel.textContent = 'MARKET CLOSED';
    else if (status === 'connected') feedLabel.textContent = 'Live Feed';
    else if (status === 'delayed') feedLabel.textContent = 'DELAYED FEED (15MIN)';
    else if (status === 'disconnected' || status === 'error') feedLabel.textContent = 'Disconnected';
    else feedLabel.textContent = 'Demo Mode';
  }

  // Market closed banner
  const mcBanner = document.getElementById('marketClosedBanner');
  if (mcBanner) mcBanner.style.display = (msg === 'Market closed') ? '' : 'none';

  // Hide streaming counter when market is closed
  const feedPipe = document.getElementById('feedPipe');
  const feedStream = document.getElementById('feedStream');
  if (feedPipe && feedStream) {
    const showStream = (msg !== 'Market closed');
    feedPipe.style.display = showStream ? '' : 'none';
    feedStream.style.display = showStream ? '' : 'none';
  }

  if (status === 'connected' || status === 'connecting') {
    if (mode === 'local') {
      el.textContent = 'LOCAL STREAM';
      el.classList.add('status-live');
    } else if (mode === 'server') {
      el.textContent = 'SERVER 2-3s';
      el.classList.add('status-server');
    } else {
      el.textContent = 'LIVE';
      el.classList.add('status-live');
    }
  } else if (status === 'disconnected' || status === 'error') {
    el.textContent = 'DISCONNECTED';
    el.classList.add('status-disconnected');
  } else if (status === 'delayed') {
    if (mode === 'local') {
      el.textContent = 'LOCAL STREAM';
      el.classList.add('status-live');
    } else {
      el.textContent = 'SERVER';
      el.classList.add('status-server');
    }
    rtEl.textContent = 'DELAYED 15MIN';
    rtEl.className = 'hdr-rt rt-delayed';
    rtEl.style.display = '';
    isRealtime = false;
    return;
  } else {
    el.textContent = 'DEMO';
    el.classList.add('status-demo');
  }

  // RT badge
  if (status === 'connected' && mode !== 'demo') {
    rtEl.textContent = 'RT';
    rtEl.className = 'hdr-rt rt-realtime';
    rtEl.style.display = '';
    isRealtime = true;
  } else if (mode === 'demo') {
    rtEl.style.display = 'none';
  }
}

// ==================== CONNECTION OVERLAY ====================
function setupConnectionOverlay() {
  const overlay = document.getElementById('connOverlay');
  const modeBtns = document.querySelectorAll('.conn-mode-btn');
  const localSection = document.getElementById('connLocal');
  const serverSection = document.getElementById('connServer');
  const errorEl = document.getElementById('connError');

  // If ?demo=true, skip overlay
  if (DEMO_MODE) {
    overlay.style.display = 'none';
    startDemoMode();
    return;
  }

  // Mode toggle
  modeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      modeBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const mode = btn.dataset.mode;
      localSection.classList.toggle('active', mode === 'local');
      serverSection.classList.toggle('active', mode === 'server');
      errorEl.style.display = 'none';
    });
  });

  // Local connect
  document.getElementById('localConnect').addEventListener('click', () => {
    errorEl.style.display = 'none';
    overlay.style.display = 'none';
    connectionMode = 'local';
    startLiveMode('local', {});
  });

  // Server connect
  document.getElementById('serverConnect').addEventListener('click', () => {
    const serverUrl = document.getElementById('serverUrl').value.trim();
    const appKey = document.getElementById('serverAppKey').value.trim();
    const username = document.getElementById('serverUser').value.trim();
    const password = document.getElementById('serverPass').value.trim();

    if (!serverUrl || !appKey || !username || !password) {
      errorEl.textContent = 'All fields required for server mode.';
      errorEl.style.display = 'block';
      return;
    }

    errorEl.style.display = 'none';
    overlay.style.display = 'none';
    connectionMode = 'server';
    startLiveMode('server', { serverUrl, appKey, username, password });
  });

  // Demo link opens ?demo in new tab via href/target="_blank" on the anchor
}

// ==================== LIVE MODE ====================
function startLiveMode(mode, config) {
  updateConnectionStatus('connecting', mode);

  provider = new DataProvider();

  provider.on('snapshot', (msg) => {
    // Load initial data
    if (msg.quotes) {
      Object.keys(msg.quotes).forEach(tk => { lp[tk] = { ...msg.quotes[tk] }; });
    }
    if (msg.chains) {
      Object.keys(msg.chains).forEach(tk => { liveChains[tk] = msg.chains[tk]; });
    }
    if (msg.flow) {
      Object.keys(msg.flow).forEach(tk => {
        liveFlow[tk] = msg.flow[tk];
        if (msg.flow[tk].unusual) liveUnusual[tk] = msg.flow[tk].unusual;
      });
    }
    if (msg.expirations) {
      // Expirations can be a list (new) or object (legacy)
      const exps = Array.isArray(msg.expirations)
        ? msg.expirations.filter(e => e)
        : Object.values(msg.expirations).filter(e => e);
      if (exps.length > 0) updateExpirationDropdowns([...new Set(exps)]);
    }
    if (msg.status) updateConnectionStatus(msg.status, mode, msg.msg);
    renderAll();
  });

  provider.on('quote', (ticker, data) => {
    const prev = lp[ticker] || {};
    Object.keys(data).forEach(k => { if (data[k] != null) prev[k] = data[k]; });
    lp[ticker] = prev;
    feedAge = 0;

    // Efficient DOM update (no full re-render)
    const pe = document.getElementById('tp-' + ticker);
    const ce = document.getElementById('tc-' + ticker);
    const se = document.getElementById('sp-' + ticker);
    if (pe) {
      const old = parseFloat(pe.textContent);
      pe.textContent = fmtD(prev.last || 0);
      pe.style.color = (prev.last || 0) > old ? 'var(--green)' : (prev.last || 0) < old ? 'var(--red)' : 'var(--white)';
    }
    if (ce) {
      const chg = prev.chg || 0;
      ce.textContent = (chg >= 0 ? '+' : '') + fmtD(chg);
      ce.className = 'tk-chg ' + (chg >= 0 ? 'up' : 'dn');
    }
    if (se) {
      se.textContent = fmtD(prev.last || 0);
    }
  });

  provider.on('flow', (ticker, data) => {
    liveFlow[ticker] = data;
    if (data.unusual) liveUnusual[ticker] = data.unusual;
    renderFlow();
    renderSentiment();
    renderAllCharts();
  });

  provider.on('chain', (ticker, expiration, data) => {
    if (!liveChains[ticker]) liveChains[ticker] = {};
    liveChains[ticker][expiration] = data;
    if (ticker === selectedChainTk) renderChain();
    if (ticker === document.getElementById('strikeTk').value) renderStrikeChart();
  });

  provider.on('expirations', (exps) => {
    if (exps && exps.length > 0) updateExpirationDropdowns(exps);
  });

  provider.on('status', (msg) => {
    const st = msg.status || 'connected';
    updateConnectionStatus(st, mode, msg.msg);

    if (st === 'error') {
      console.error('Connection error:', msg.msg);
      // Show error on overlay
      const errorEl = document.getElementById('connError');
      errorEl.textContent = msg.msg || 'Connection failed';
      errorEl.style.display = 'block';
      document.getElementById('connOverlay').style.display = 'flex';
    }
  });

  provider.connect(mode, config);
}

// ==================== DEMO MODE (Simulation Engine) ====================
let demoTimers = [];

function startDemoMode() {
  connectionMode = 'demo';
  updateConnectionStatus('demo', 'demo');

  // Load demo data
  TICKERS.forEach(t => {
    lp[t] = { ...DEMO_QUOTES[t] };
    liveFlow[t] = { ...DEMO_FLOW[t] };
    liveUnusual[t] = (DEMO_UNUSUAL[t] || []).map(a => ({ ...a }));
    if (DEMO_CHAINS[t]) {
      liveChains[t] = {};
      DEMO_EXPIRATIONS.forEach(exp => {
        liveChains[t][exp] = { c: DEMO_CHAINS[t].c.map(c => ({...c})), p: DEMO_CHAINS[t].p.map(p => ({...p})) };
      });
    }
  });

  updateExpirationDropdowns(DEMO_EXPIRATIONS);
  renderAll();

  // Simulation timers
  demoTimers.push(setInterval(demoTickPrices, 2000));
  demoTimers.push(setInterval(demoTickChainPrices, 3000));
  const pool = [];
  Object.keys(DEMO_UNUSUAL).forEach(t => DEMO_UNUSUAL[t].forEach(a => pool.push({ tk: t, ...a })));
  (function sched() {
    const id = setTimeout(() => { demoInjectOrder(pool); sched(); }, 1500 + Math.random() * 3000);
    demoTimers.push(id);
  })();
}

function demoTickPrices() {
  Object.keys(lp).forEach(t => {
    const p = lp[t]; const spread = Math.max(0.01, (p.last||0) * 0.0003);
    const d = (Math.random() - 0.48) * spread;
    const old = p.last || 0;
    p.last = Math.round((old + d) * 100) / 100;
    p.chg = Math.round(((p.chg||0) + d) * 100) / 100;
    const pe = document.getElementById('tp-' + t);
    const ce = document.getElementById('tc-' + t);
    const se = document.getElementById('sp-' + t);
    if (pe) { pe.textContent = fmtD(p.last); pe.style.color = p.last > old ? 'var(--green)' : p.last < old ? 'var(--red)' : 'var(--white)'; }
    if (ce) { ce.textContent = (p.chg >= 0 ? '+' : '') + fmtD(p.chg); ce.className = 'tk-chg ' + (p.chg >= 0 ? 'up' : 'dn'); }
    if (se) { se.textContent = fmtD(p.last); se.style.color = p.last > old ? 'var(--green)' : p.last < old ? 'var(--red)' : 'var(--white)'; }
  });
}

function demoTickChainPrices() {
  const tk = selectedChainTk;
  const tkChains = liveChains[tk];
  if (!tkChains) return;
  const data = (selectedChainExp && tkChains[selectedChainExp])
    ? tkChains[selectedChainExp]
    : Object.values(tkChains)[0];
  if (!data) return;
  data.c.forEach(c => {
    if (c.b == null || c.a == null) return;
    const sp = c.a - c.b; const mv = (Math.random() - 0.5) * sp * 0.3;
    c.l = Math.max(0.01, Math.round((c.l + mv) * 100) / 100);
    c.b = Math.max(0.01, Math.round((c.b + mv * 0.5) * 100) / 100);
    c.a = Math.max(0.01, Math.round((c.a + mv * 0.5) * 100) / 100);
    if (c.b >= c.a) c.a = c.b + 0.01;
    // Simulate volume arriving at this strike
    const vAdd = Math.random() < 0.4 ? Math.floor(Math.random() * (c.v || 50) * 0.08) : 0;
    c.v = (c.v || 0) + vAdd;
  });
  data.p.forEach(p => {
    if (p.b == null || p.a == null) return;
    const sp = p.a - p.b; const mv = (Math.random() - 0.5) * sp * 0.3;
    p.l = Math.max(0.01, Math.round((p.l + mv) * 100) / 100);
    p.b = Math.max(0.01, Math.round((p.b + mv * 0.5) * 100) / 100);
    p.a = Math.max(0.01, Math.round((p.a + mv * 0.5) * 100) / 100);
    if (p.b >= p.a) p.a = p.b + 0.01;
    const vAdd = Math.random() < 0.4 ? Math.floor(Math.random() * (p.v || 50) * 0.08) : 0;
    p.v = (p.v || 0) + vAdd;
  });
  renderChain();
  renderStrikeChart();
}

function demoInjectOrder(pool) {
  const base = pool[Math.floor(Math.random() * pool.length)];
  const v = Math.round(base.v * (0.05 + Math.random() * 0.3));
  const l = Math.round(base.l * (0.97 + Math.random() * 0.06) * 100) / 100;
  const prem = v * l * 100;
  const s = sig(base.d, base.t);
  orderCt++; totalPrem += prem;
  document.getElementById('orderCt').textContent = orderCt.toLocaleString();
  document.getElementById('totalPrem').textContent = fmtP(totalPrem);
  feedAge = 0;

  const tbody = document.getElementById('flowBody');
  const golden = prem > 5e6;
  const rc = base.t === 'C' ? 'call-row' : 'put-row';
  const bc = base.t === 'C' ? 'badge-c' : 'badge-p';
  const tl = base.t === 'C' ? 'CALL' : 'PUT';
  const sc = sigCls(s);
  const gt = golden ? '<span class="golden-tag">\u2605</span>' : '';
  const demoExp = base.exp || DEMO_EXPIRATIONS[Math.floor(Math.random() * DEMO_EXPIRATIONS.length)];
  const oiVal = base.oi ? fmtN(Math.round(base.oi * (0.9 + Math.random() * 0.2))) : '--';
  const tr = document.createElement('tr');
  tr.className = golden ? 'golden-row' : rc;
  tr.innerHTML = `<td><b>${base.tk}</b></td><td><span class="exp-tag">${demoExp}</span></td><td><span class="badge ${bc}">${tl}</span></td><td>$${base.s}</td><td>${fmtD(l)}</td><td>${fmtN(v)}</td><td>${oiVal}</td><td>${gt}<b>${fmtP(prem)}</b></td><td>${base.d.toFixed(4)}</td><td><span class="${sc}">${s}</span></td>`;

  const ft = document.querySelector('.fbtn.on')?.dataset.f || 'all';
  const tk = document.getElementById('tkFilter').value;
  const expF = document.getElementById('expFilter').value;
  let show = true;
  if (ft === 'calls' && base.t !== 'C') show = false;
  if (ft === 'puts' && base.t !== 'P') show = false;
  if (tk && base.tk !== tk) show = false;
  if (expF && !demoExp.includes(expF)) show = false;
  if (!show) tr.style.display = 'none';

  tbody.firstChild ? tbody.insertBefore(tr, tbody.firstChild) : tbody.appendChild(tr);
  while (tbody.children.length > 100) tbody.removeChild(tbody.lastChild);
}

// ==================== CLOCK & FEED AGE ====================
function tickClock() {
  const n = new Date();
  const h = String(n.getHours()).padStart(2, '0');
  const m = String(n.getMinutes()).padStart(2, '0');
  const s = String(n.getSeconds()).padStart(2, '0');
  document.getElementById('clock').textContent = h + ':' + m + ':' + s + ' EST';
  document.getElementById('ftrTime').textContent = n.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) + ' ' + h + ':' + m + ':' + s;
}

// ==================== FULL RENDER ====================
function renderAll() {
  renderTickers();
  renderSentiment();
  renderFlow();
  renderChain();
  renderAllCharts();
}

// ==================== INIT ====================
function init() {
  // Setup event listeners
  setupFilters();
  document.getElementById('strikeTk').addEventListener('change', renderStrikeChart);
  document.getElementById('flowDistFilter').addEventListener('change', renderDonuts);
  document.getElementById('chainTk').addEventListener('change', function() {
    selectedChainTk = this.value;
    renderChain();
    renderStrikeChart();
  });
  document.getElementById('chainExp').addEventListener('change', function() {
    selectedChainExp = this.value;
    // When live, request new expiration chain data
    // For now, re-render with available data
    renderChain();
  });

  // Clock
  setInterval(tickClock, 1000);
  setInterval(() => { feedAge++; const e = document.getElementById('feedAge'); if (e) e.textContent = feedAge + 's'; }, 1000);

  // Setup connection overlay (or auto-demo)
  setupConnectionOverlay();
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
